### 요약

* 캔버스의 **Streamlit VOC Topic Explorer (JSON)** 코드에 **반지도(하이브리드) 분류** 기능을 바로 넣어두었습니다.
* 이제 일부 카테고리는 **사전 정의(Seed)** 로 지정하고, **나머지 문서만 비지도 클러스터링**으로 자동 토픽화합니다.
* 지원하는 시드 방식: **키워드/정규식**, **예시문장(임베딩 근접)**.
* 결과에는 **최종 라벨(final_label)**, **라벨 출처(label_source: SEED/AUTO/NOISE)**, **매칭 방식/점수(seed_method/seed_score)**가 포함됩니다.
* 사이드바에 **Seed 업로드/입력 UI**, 임계값·제외 옵션을 추가했고, 상단 KPI에 **SEED 적용 비율**을 표시합니다.

---

### 어떻게 쓰면 되나요? (사용법)

1. **Seed 데이터 준비**

   * **CSV** 포맷(권장 간단형)

     * 컬럼: `category,type,value`
     * `type` ∈ `{keyword, regex, example}`
     * 예시:

       ```
       category,type,value
       결제/이중청구,keyword,이중 결제
       결제/이중청구,regex,결제.*중복
       로그인/인증,example,문자인증이 계속 실패합니다
       로그인/인증,example,OTP 번호가 도착하지 않습니다
       ```
   * **JSON** 포맷

     ```json
     [
       {"category":"결제/이중청구","type":"keyword","value":"이중 결제"},
       {"category":"결제/이중청구","type":"regex","value":"결제.*중복"},
       {"category":"로그인/인증","type":"example","value":"문자인증이 계속 실패합니다"},
       {"category":"로그인/인증","type":"example","value":"OTP 번호가 도착하지 않습니다"}
     ]
     ```
   * 팁: **예시문장(example)** 은 해당 카테고리의 전형적인 VOC 문장을 3~10개씩 주면 임베딩 프로토타입이 더 안정적이에요.

2. **앱 실행 후 사이드바 설정**

   * `Seed 파일 (CSV 또는 JSON)` 업로드 **혹은** `JSON 배열 직접 입력`에 붙여넣기
   * 옵션:

     * **키워드/정규식 매칭 사용**: 단순 포함/정규식으로 빠르게 선별
     * **예시문장 임베딩 매칭 사용**: 예시문장과 의미적으로 가까우면 할당
       → **임계값(cos sim)** 슬라이더(기본 0.55, 데이터에 맞춰 0.50~0.70대 조절 권장)
     * **SEED로 할당된 문서는 클러스터링에서 제외**: 체크하면 Seed로 먼저 붙은 문서들은 비지도 단계에서 제외되어 자동 토픽이 “잡음 없이” 남은 이슈를 더 잘 드러냅니다.
   * 나머지는 기존과 동일하게 텍스트 필드를 선택 후 **토픽 생성 실행** 클릭

3. **결과 확인**

   * 상단 KPI에 **SEED 적용 비율**이 추가
   * 문서 테이블에 **final_label, label_source, seed_method, seed_score** 표시

     * `label_source=SEED` 면 시드로 확정, `AUTO` 면 비지도 라벨, `NOISE` 면 어느 쪽에도 안 걸린 항목
   * 기존 **UMAP 산점도/클러스터 크기/키워드/샘플 문장/시계열**도 그대로 사용 가능

---

### 내부 동작 (간단한 원리)

1. **Seed 매칭 단계**

   * **키워드/정규식**: 문서 텍스트(전처리된 `text_clean`)에 대해 카테고리별 점수를 합산(키워드 등장 수 + 정규식 매칭 수). 최대 점수 카테고리로 선할당.
   * **예시문장 임베딩**: 카테고리별 예시문장 임베딩 평균으로 **프로토타입 벡터** 생성 → 문서 임베딩과 **코사인 유사도**로 가장 가까운 카테고리에 임계값 이상이면 할당.
2. **비지도 단계**

   * (옵션) Seed로 이미 붙은 문서는 **제외**하고 남은 문서만 **HDBSCAN/BERTopic**으로 자동 군집 → c-TF-IDF 키워드로 **AUTO 라벨** 생성.
3. **최종 라벨링**

   * **SEED 우선** → 없으면 **AUTO 라벨** → 둘 다 없으면 `기타/노이즈`.
   * 내보내기 CSV에 이 컬럼들이 포함됩니다.

---

### 파라미터 튜닝 팁

* **예시문장 임계값**

  * 0.50~0.60: 조금 공격적으로 붙음(재현율↑, 정밀도↓)
  * 0.60~0.70: 보수적으로 붙음(정밀도↑, 재현율↓)
* **키워드/정규식**

  * 다의어/중의어가 많으면 정규식으로 **문맥 제약**(예: `환불(요청|신청)`), 너무 넓으면 노이즈↑
* **min_topic_size**

  * 클러스터가 너무 쪼개지면 값↑, 너무 크게 합쳐지면 값↓
* **Seed 제외 여부**

  * 대체로 **제외 = 권장**(Seed가 먹은 영역을 치우고 “잔여 이슈”를 더 잘 보여줌)

---

### 추가로 원하시면 더 붙여드릴 수 있어요

* **시드 카테고리 계층화**(상·하위 라벨) 및 **일괄 리네이밍/머지** 도구
* **활용 리포트**: 주간/월간 Seed vs Auto 비중, 신규 Auto 토픽 발생 트렌드
* **정확도 평가 뷰**: Seed 라벨과 실제 운영 라벨(정답) 비교(precision/recall/F1)

필요하신 시드 예시를 몇 개만 주시면, 적절한 **임계값 추천**과 **키워드 세트 템플릿**까지 바로 구성해 드릴게요!
