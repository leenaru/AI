# ğŸ“Š **MobileCLIP ì„±ëŠ¥ í‰ê°€ ë° ë¦¬í¬íŒ… ë°©ë²•**  

## ğŸ”¹ **ìš”ì•½: ì„±ëŠ¥ í‰ê°€ ì ˆì°¨**
1. **ë°ì´í„° ì¤€ë¹„**  
   - í•™ìŠµ ë°ì´í„°ì…‹ê³¼ ë³„ë„ë¡œ í…ŒìŠ¤íŠ¸(ê²€ì¦)ìš© ë°ì´í„°ì…‹ì„ êµ¬ì„±.  
   - Ground Truth(ì •ë‹µ)ê³¼ ëª¨ë¸ì˜ ì˜ˆì¸¡ê°’ì„ ë¹„êµ.  

2. **ì„±ëŠ¥ í‰ê°€ ì§€í‘œ ì„ ì •**  
   - ğŸ”¹ **í…ìŠ¤íŠ¸-ì´ë¯¸ì§€ ë§¤ì¹­ ì •í™•ë„** (Top-1, Top-5 Accuracy)  
   - ğŸ”¹ **Cosine Similarity** (ì´ë¯¸ì§€-í…ìŠ¤íŠ¸ ë²¡í„° ìœ ì‚¬ë„)  
   - ğŸ”¹ **Mean Rank / Median Rank** (ì •í™•í•œ ë§¤ì¹­ì´ ëª‡ ë²ˆì§¸ ìˆœìœ„ë¡œ ì˜ˆì¸¡ë˜ì—ˆëŠ”ì§€)  
   - ğŸ”¹ **Retrieval Performance (Recall@K, Precision@K)**  

3. **ëª¨ë¸ í‰ê°€ ì½”ë“œ ì‘ì„±**  
   - MobileCLIP ëª¨ë¸ì„ í‰ê°€í•˜ëŠ” PyTorch ì½”ë“œ êµ¬í˜„.  

4. **ê²°ê³¼ ë¦¬í¬íŒ…**  
   - ì‹œê°ì ìœ¼ë¡œ ë³´ê¸° ì¢‹ê²Œ **í‘œ, ê·¸ë˜í”„, íˆíŠ¸ë§µ**ìœ¼ë¡œ í‘œí˜„.  

---

## ğŸ”¹ **1. ë°ì´í„° ì¤€ë¹„: í‰ê°€ìš© ë°ì´í„°ì…‹ êµ¬ì¶•**
> ğŸ“Œ **ëª¨ë¸ì„ í•™ìŠµí•œ ë°ì´í„°ì™€ ë‹¤ë¥¸ ë°ì´í„°ì…‹ì„ ì‚¬ìš©í•´ì•¼ ê³µì •í•œ í‰ê°€ ê°€ëŠ¥**  
> - í•™ìŠµ ë°ì´í„°: ëª¨ë¸ì´ í•™ìŠµí•œ ì‚¬ì§„ê³¼ í…ìŠ¤íŠ¸  
> - í‰ê°€ ë°ì´í„°: í•™ìŠµì— ì‚¬ìš©ë˜ì§€ ì•Šì€ ìƒˆë¡œìš´ ì‚¬ì§„ê³¼ í…ìŠ¤íŠ¸  

ğŸ“ **í‰ê°€ìš© ë°ì´í„° ì˜ˆì‹œ (CSV)**
```csv
image_path,text
./test_images/cat.jpg,ê³ ì–‘ì´ê°€ ì°½ê°€ì— ì•‰ì•„ ìˆë‹¤.
./test_images/dog.jpg,ê°•ì•„ì§€ê°€ ê³µì„ ë¬¼ê³  ìˆë‹¤.
./test_images/coffee.jpg,ì¹´í˜ í…Œì´ë¸” ìœ„ì˜ ì»¤í”¼ì”.
```

ğŸ“ **CSV íŒŒì¼ ë¡œë“œ ì½”ë“œ**
```python
import pandas as pd

# í‰ê°€ìš© ë°ì´í„°ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°
test_dataset = pd.read_csv("test_dataset.csv")

# ì´ë¯¸ì§€ ë° í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬
test_images, test_texts = [], []
for _, row in test_dataset.iterrows():
    test_images.append(preprocess_image(row["image_path"]))
    test_texts.append(preprocess_text(row["text"]))

test_images = torch.stack(test_images)
test_texts = {key: torch.cat([t[key] for t in test_texts], dim=0) for key in test_texts[0]}
```

---

## ğŸ”¹ **2. ì„±ëŠ¥ í‰ê°€ ì§€í‘œ ì„ ì •**
MobileCLIPì˜ ì„±ëŠ¥ì„ í‰ê°€í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì§€í‘œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

### âœ… 1) **í…ìŠ¤íŠ¸-ì´ë¯¸ì§€ ë§¤ì¹­ ì •í™•ë„ (Top-K Accuracy)**
- `Top-1 Accuracy`: ì •ë‹µì´ ëª¨ë¸ì˜ 1ìˆœìœ„ ì˜ˆì¸¡ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ë¹„ìœ¨
- `Top-5 Accuracy`: ì •ë‹µì´ ëª¨ë¸ì˜ ìƒìœ„ 5ê°œ ì˜ˆì¸¡ê°’ ì¤‘ í•˜ë‚˜ì™€ ì¼ì¹˜í•˜ëŠ” ë¹„ìœ¨  

> **ğŸ“Œ ì˜ˆì œ**
> - ëª¨ë¸ì´ `["ê°•ì•„ì§€", "ê³ ì–‘ì´", "ìë™ì°¨", "ì»¤í”¼", "ë‚˜ë¬´"]` ìˆœìœ¼ë¡œ ì˜ˆì¸¡í–ˆì„ ë•Œ,  
> - ì •ë‹µì´ `"ê³ ì–‘ì´"`ë¼ë©´, `Top-1 ì‹¤íŒ¨, Top-5 ì„±ê³µ`

ğŸ“ **Accuracy ê³„ì‚° ì½”ë“œ**
```python
def compute_accuracy(logits_per_image, labels, top_k=1):
    """
    Top-K Accuracy ê³„ì‚° í•¨ìˆ˜
    """
    top_k_preds = torch.topk(logits_per_image, k=top_k, dim=-1).indices
    correct = (top_k_preds == labels.unsqueeze(1)).any(dim=-1).float().mean()
    return correct.item()

# í‰ê°€ ì§„í–‰
with torch.no_grad():
    logits_per_image, _ = model(test_images, test_texts)
    labels = torch.arange(len(test_images)).to(logits_per_image.device)

    top1_acc = compute_accuracy(logits_per_image, labels, top_k=1)
    top5_acc = compute_accuracy(logits_per_image, labels, top_k=5)

print(f"Top-1 Accuracy: {top1_acc:.2%}")
print(f"Top-5 Accuracy: {top5_acc:.2%}")
```

---

### âœ… 2) **Cosine Similarity (ì½”ì‚¬ì¸ ìœ ì‚¬ë„)**
> - ëª¨ë¸ì´ ìƒì„±í•œ ì´ë¯¸ì§€ ì„ë² ë”©ê³¼ í…ìŠ¤íŠ¸ ì„ë² ë”©ì´ ì–¼ë§ˆë‚˜ ìœ ì‚¬í•œì§€ í‰ê°€.  
> - `1.0`ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì¢‹ì€ ì„±ëŠ¥.

ğŸ“ **ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚° ì½”ë“œ**
```python
import torch.nn.functional as F

def compute_cosine_similarity(image_features, text_features):
    """
    ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ ì„ë² ë”© ê°„ì˜ í‰ê·  ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚°
    """
    cosine_sim = F.cosine_similarity(image_features, text_features)
    return cosine_sim.mean().item()

with torch.no_grad():
    image_features = model.image_encoder(test_images)
    text_features = model.text_encoder(test_texts["input_ids"], test_texts["attention_mask"])

    cosine_sim = compute_cosine_similarity(image_features, text_features)

print(f"Mean Cosine Similarity: {cosine_sim:.4f}")
```

---

### âœ… 3) **Retrieval Performance (Recall@K, Precision@K)**
- `Recall@K`: ëª¨ë¸ì´ `K`ê°œì˜ í›„ë³´ ì¤‘ ì •ë‹µì„ í¬í•¨í•˜ëŠ” ë¹„ìœ¨
- `Precision@K`: `K`ê°œ ì¤‘ ì‹¤ì œë¡œ ì˜¬ë°”ë¥¸ ì˜ˆì¸¡ì˜ ë¹„ìœ¨

ğŸ“ **Recall@K ê³„ì‚° ì½”ë“œ**
```python
def compute_recall_at_k(logits_per_image, labels, k=5):
    top_k_preds = torch.topk(logits_per_image, k=k, dim=-1).indices
    recall = (top_k_preds == labels.unsqueeze(1)).any(dim=-1).float().mean()
    return recall.item()

with torch.no_grad():
    recall_at_5 = compute_recall_at_k(logits_per_image, labels, k=5)

print(f"Recall@5: {recall_at_5:.2%}")
```

---

## ğŸ”¹ **3. ë¦¬í¬íŒ…: ì‹œê°ì  í‘œí˜„ (í‘œ & ê·¸ë˜í”„)**
ğŸ“ **ì„±ëŠ¥ ê²°ê³¼ë¥¼ ë³´ê¸° ì¢‹ê²Œ ì •ë¦¬í•˜ëŠ” ë°©ë²•**

```python
import pandas as pd
import matplotlib.pyplot as plt

# í‰ê°€ ê²°ê³¼ ì €ì¥
results = {
    "Metric": ["Top-1 Accuracy", "Top-5 Accuracy", "Mean Cosine Similarity", "Recall@5"],
    "Score": [top1_acc, top5_acc, cosine_sim, recall_at_5]
}

df_results = pd.DataFrame(results)

# í‘œë¡œ ì¶œë ¥
import ace_tools as tools
tools.display_dataframe_to_user(name="MobileCLIP ì„±ëŠ¥ í‰ê°€ ê²°ê³¼", dataframe=df_results)
```

ğŸ“ **ë§‰ëŒ€ ê·¸ë˜í”„ ì‹œê°í™”**
```python
plt.figure(figsize=(8, 5))
plt.bar(df_results["Metric"], df_results["Score"], color=["blue", "green", "red", "purple"])
plt.ylabel("Score")
plt.title("MobileCLIP ì„±ëŠ¥ í‰ê°€ ê²°ê³¼")
plt.ylim(0, 1)
plt.show()
```

---

## ğŸ¯ **ìµœì¢… ë¦¬í¬íŠ¸ ì˜ˆì‹œ**
| Metric                 | Score  |
|------------------------|--------|
| Top-1 Accuracy        | 85.4%  |
| Top-5 Accuracy        | 97.2%  |
| Mean Cosine Similarity | 0.82   |
| Recall@5              | 92.5%  |

ğŸ“Œ **ğŸ“Š ê·¸ë˜í”„ ì˜ˆì‹œ**  
âœ… `Top-1 Accuracy`ê°€ ë‚®ë‹¤ë©´ ë°ì´í„° ë¼ë²¨ë§ ê°œì„  í•„ìš”  
âœ… `Cosine Similarity`ê°€ ë‚®ë‹¤ë©´ ëª¨ë¸ í•™ìŠµì´ ë¶€ì¡± â†’ ë” ë§ì€ ë°ì´í„° í•„ìš”  

---

## ğŸ”¹ **ê²°ë¡ **
- **MobileCLIP ëª¨ë¸ í‰ê°€ ìˆœì„œ** âœ…  
  - â‘  **ë°ì´í„°ì…‹ ì¤€ë¹„**: í•™ìŠµ ë°ì´í„°ì™€ ë‹¤ë¥¸ í‰ê°€ ë°ì´í„° ì‚¬ìš©  
  - â‘¡ **ì„±ëŠ¥ ì§€í‘œ ê³„ì‚°**: `Top-K Accuracy`, `Cosine Similarity`, `Recall@K`  
  - â‘¢ **ì‹œê°ì  ë¦¬í¬íŠ¸**: í‘œ & ê·¸ë˜í”„ í™œìš©  

ğŸ‘‰ **ì´ì œ ëª¨ë¸ ì„±ëŠ¥ì„ ìˆ˜ì¹˜ë¡œ ë¹„êµí•˜ê³ , ê°œì„  ë°©í–¥ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!** ğŸš€  
ì¶”ê°€ ì§ˆë¬¸ì´ ìˆìœ¼ë©´ ì–¸ì œë“  ë¬¼ì–´ë³´ì„¸ìš” ğŸ˜Š
