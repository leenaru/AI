>>> Llama3ë¥¼ gguf íŒŒì¼ë¡œ ë¡œì»¬ì— ë‹¤ìš´ë°›ì•„ì„¤ì¹˜í•˜ê³  ollamaë¥¼ ì´ìš©í•´ì„œ langgraphì—°ë™í•´ì„œ ì§ˆë¬¸ì— ëŒ€í•œ ì˜ë„ë¥¼ íŒŒì•…í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•´ì¤˜


ì•„ë˜ëŠ” Llama3 ëª¨ë¸ì˜ GGUF íŒŒì¼ì„ ë¡œì»¬ì— ì„¤ì¹˜í•˜ê³ , Ollamaë¥¼ í†µí•´ LangGraphì™€ ì—°ë™í•˜ì—¬ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ëŒ€í•œ ì˜ë„ë¥¼ íŒŒì•…í•˜ëŠ” ì˜ˆì œ ì½”ë“œ ë° ê³¼ì •ì…ë‹ˆë‹¤.

### ë‹¨ê³„ë³„ ì„¤ì¹˜ ë° êµ¬í˜„ ë°©ë²•

---

## 1. GGUF íŒŒì¼ì„ ì´ìš©í•œ ë¡œì»¬ Llama3 ì„¤ì¹˜ (Ollama ì‚¬ìš©)

OllamaëŠ” ìë™ìœ¼ë¡œ ëª¨ë¸ì„ ê´€ë¦¬í•˜ì§€ë§Œ, GGUF íŒŒì¼ì„ ì§ì ‘ ì„¤ì¹˜í•˜ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒ ì ˆì°¨ë¥¼ ë”°ë¦…ë‹ˆë‹¤.

### GGUF íŒŒì¼ ë‹¤ìš´ë¡œë“œ

* [Llama3 GGUF ëª¨ë¸](https://huggingface.co/TheBloke/Llama-3-8B-GGUF) ì—ì„œ ì›í•˜ëŠ” ëª¨ë¸ (ì˜ˆ: `llama-3-8b-instruct.Q4_K_M.gguf`)ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë¡œì»¬ì— ì €ì¥í•©ë‹ˆë‹¤.

ì˜ˆì‹œ ê²½ë¡œ:

```
~/models/llama-3-8b-instruct.Q4_K_M.gguf
```

---

## 2. Ollamaì— GGUF ëª¨ë¸ ë“±ë¡ ë° ì‹¤í–‰

ë¨¼ì € Ollamaë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
curl -fsSL https://ollama.com/install.sh | sh
```

ë‹¤ìŒê³¼ ê°™ì´ ëª¨ë¸ì„ ë¡œì»¬ì—ì„œ ë“±ë¡í•©ë‹ˆë‹¤.

### ëª¨ë¸ ë“±ë¡ ëª…ë ¹ì–´

```bash
ollama create llama3-local -f Modelfile
```

### Modelfile ë‚´ìš© (`Modelfile`)

```
FROM ./models/llama-3-8b-instruct.Q4_K_M.gguf
TEMPLATE """<|begin_of_text|><|start_header_id|>user<|end_header_id|>
{{ .Prompt }}<|eot_id|><|start_header_id|>assistant<|end_header_id|>
"""
```

ëª¨ë¸ ì‹¤í–‰ í…ŒìŠ¤íŠ¸:

```bash
ollama run llama3-local
```

ëª¨ë¸ì´ ì •ìƒì ìœ¼ë¡œ ë¡œë”©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

---

## 3. Python í™˜ê²½ ì„¤ì •

í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (LangGraph, Ollama Python í´ë¼ì´ì–¸íŠ¸):

```bash
pip install langgraph ollama
```

---

## 4. LangGraphì™€ Ollamaë¥¼ ì´ìš©í•œ Intent Detection ì½”ë“œ êµ¬í˜„

ë‹¤ìŒì€ LangGraphë¥¼ ì‚¬ìš©í•˜ì—¬ Ollamaì˜ Llama3 ëª¨ë¸ì„ í˜¸ì¶œí•˜ê³ , ì‚¬ìš©ìì˜ ì§ˆë¬¸ìœ¼ë¡œë¶€í„° ì˜ë„ë¥¼ ì¶”ì¶œí•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.

### ì˜ˆì œ ì½”ë“œ (`llama3_langgraph_intent.py`)

```python
from langgraph.graph import END, StateGraph
from langgraph.prebuilt import ToolNode
from typing import TypedDict, List
import ollama
import json

# ìƒíƒœë¥¼ ê´€ë¦¬í•  í´ë˜ìŠ¤ ì •ì˜
class AgentState(TypedDict):
    prompt: str
    intent: str

# Ollama í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ Llama3 í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜
def llama3_intent_classifier(prompt: str) -> str:
    system_prompt = (
        "ë‹¤ìŒ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ ì˜ë„ë¥¼ 'ì—¬í–‰ì˜ˆì•½', 'í˜¸í…”ì˜ˆì•½', 'ì‹ë‹¹ì˜ˆì•½', 'í•­ê³µì˜ˆì•½', 'ê¸°íƒ€' ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”.\n"
        "ê²°ê³¼ëŠ” JSON í˜•íƒœë¡œ {\"intent\": \"ë¶„ë¥˜ê²°ê³¼\"} ë¡œë§Œ ë‹µë³€í•˜ì„¸ìš”."
    )

    response = ollama.chat(
        model="llama3-local",
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": prompt},
        ]
    )

    try:
        intent_json = json.loads(response['message']['content'])
        return intent_json.get('intent', 'ê¸°íƒ€')
    except json.JSONDecodeError:
        return 'ê¸°íƒ€'

# LangGraph ë…¸ë“œ ì •ì˜
def classify_intent(state: AgentState) -> AgentState:
    prompt = state['prompt']
    intent = llama3_intent_classifier(prompt)
    return {"prompt": prompt, "intent": intent}

# ê·¸ë˜í”„ ìƒì„±
workflow = StateGraph(AgentState)

# ì˜ë„ ë¶„ë¥˜ ë…¸ë“œ ì¶”ê°€
workflow.add_node("intent_classifier", classify_intent)
workflow.set_entry_point("intent_classifier")
workflow.add_edge("intent_classifier", END)

app = workflow.compile()

# ì‹¤í–‰ ì˜ˆì‹œ
if __name__ == "__main__":
    user_input = input("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”: ")
    result = app.invoke({"prompt": user_input})
    print(f"ì§ˆë¬¸: {result['prompt']}\nì˜ë„: {result['intent']}")
```

---

## 5. ì‹¤í–‰ ë°©ë²•

ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ ë™ì‘ í™•ì¸:

```bash
python llama3_langgraph_intent.py
```

### ì‹¤í–‰ ì˜ˆì‹œ

```bash
ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”: ë‚´ì¼ ì˜¤ì „ 10ì‹œ ì¸ì²œì—ì„œ ë„ì¿„ ê°€ëŠ” ë¹„í–‰ê¸° ì˜ˆì•½í•´ì¤˜
ì§ˆë¬¸: ë‚´ì¼ ì˜¤ì „ 10ì‹œ ì¸ì²œì—ì„œ ë„ì¿„ ê°€ëŠ” ë¹„í–‰ê¸° ì˜ˆì•½í•´ì¤˜
ì˜ë„: í•­ê³µì˜ˆì•½
```

---

## ìš”ì•½ ë° ì •ë¦¬

* **GGUF íŒŒì¼ ë‹¤ìš´ë¡œë“œ** í›„ ë¡œì»¬ Ollama ëª¨ë¸ë¡œ ë“±ë¡
* **Ollamaë¥¼ í†µí•´ ë¡œì»¬ì—ì„œ Llama3** ì‚¬ìš©
* **LangGraph** ë¥¼ ì‚¬ìš©í•˜ì—¬ **Ollamaì˜ Llama3 ëª¨ë¸ í˜¸ì¶œ**
* ê°„ë‹¨í•œ **intent classifier** êµ¬í˜„ ë° ì‚¬ìš©

ì´ ê³¼ì •ìœ¼ë¡œ Llama3ë¥¼ ë¡œì»¬ì— ë°°í¬í•˜ì—¬ LangGraphì™€ Ollamaë¥¼ í†µí•´ ê°„í¸í•˜ê²Œ ì˜ë„ë¥¼ ë¶„ë¥˜í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

>>> ìœ„ì˜ ì˜ˆì œì—ì„œ ì˜ë„ëŠ” ì‚¬ì „ì— ì •ì˜ëœ ê²ƒìœ¼ë¡œë§Œ ë¶„ë¥˜í•  ìˆ˜ ìˆëŠ”ê±°ì•¼? ë¶„ë¥˜ì™¸ì˜ ì˜ë„ íŒŒì•…í•˜ëŠ” ë°©ë²•ì—ëŠ” ì–´ë–¤ê²ƒì´ ìˆì„ê¹Œ

ìœ„ ì˜ˆì œëŠ” ë¯¸ë¦¬ ì •í•´ë†“ì€ ëª‡ ê°€ì§€ ì¹´í…Œê³ ë¦¬(ì˜ˆ: 'ì—¬í–‰ì˜ˆì•½', 'í˜¸í…”ì˜ˆì•½', 'ì‹ë‹¹ì˜ˆì•½', 'í•­ê³µì˜ˆì•½', 'ê¸°íƒ€') ë‚´ì—ì„œë§Œ ì˜ë„ë¥¼ ë¶„ë¥˜í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì´ ì ‘ê·¼ë²•ì„ \*\*"íì‡„í˜• ë¶„ë¥˜ (Closed-set Classification)"\*\*ë¼ê³  í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ í˜„ì‹¤ì ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì€ ì‚¬ì „ì— ì •ì˜ë˜ì§€ ì•Šì€ ë‹¤ì–‘í•œ ì˜ë„ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë©°, ì´ëŸ° ê²½ìš° ë” ìœ ì—°í•˜ê³  ê°œë°©ì ì¸ ì˜ë„ ë¶„ë¥˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

---

## ğŸ’¡ ë¶„ë¥˜ ì™¸ì˜ ë‹¤ì–‘í•œ ì˜ë„ë¥¼ íŒŒì•…í•˜ëŠ” ë°©ë²•

ì˜ë„ë¥¼ ë³´ë‹¤ ìœ ì—°í•˜ê²Œ íŒŒì•…í•˜ëŠ” ë°©ë²•ìœ¼ë¡œëŠ” í¬ê²Œ ë‹¤ìŒê³¼ ê°™ì€ ì ‘ê·¼ì´ ìˆìŠµë‹ˆë‹¤.

### 1ï¸âƒ£ **ê°œë°©í˜• ë¶„ë¥˜ (Open-set Classification)**

* **ê°œë…**

  * ì •ì˜ëœ í´ë˜ìŠ¤ ì™¸ì—ë„, ëª¨ë¸ì´ "ê¸°íƒ€(Unknown)"ë¥¼ ë„˜ì–´ ë³´ë‹¤ êµ¬ì²´ì ì¸ ì˜ë„ë¥¼ ìœ ì—°í•˜ê²Œ ì œì‹œí•˜ëŠ” ë°©ë²•.
  * LLMì˜ ìƒì„±ëŠ¥ë ¥ì„ í™œìš©í•˜ì—¬ ììœ ë¡œìš´ í˜•íƒœì˜ í…ìŠ¤íŠ¸ë¡œ ì˜ë„ë¥¼ ì„œìˆ í•©ë‹ˆë‹¤.

* **ì˜ˆì‹œ**

  * ì‚¬ìš©ì ì§ˆë¬¸: `"ì´ë²ˆì— ì—¬í–‰ê°ˆ ë•Œ ì•„ì´ë‘ ê°€ë³¼ë§Œí•œ ì²´í—˜í•  ìˆ˜ ìˆëŠ” ë†ì¥ì´ ìˆì„ê¹Œ?"`
  * íì‡„í˜• ë¶„ë¥˜: `"ê¸°íƒ€"`
  * ê°œë°©í˜• ë¶„ë¥˜: `"ì•„ì´ì™€ í•¨ê»˜í•  ìˆ˜ ìˆëŠ” ë†ì¥ ì²´í—˜ ì—¬í–‰ì§€ ì¶”ì²œ"`

* **êµ¬í˜„ë²•**

  * LLMì´ ììœ ë¡­ê²Œ ì˜ë„ë¥¼ ê¸°ìˆ í•˜ë„ë¡ system\_promptë¥¼ ë°”ê¿”ì¤ë‹ˆë‹¤.

```python
system_prompt = (
    "ë‹¤ìŒ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì˜ í•µì‹¬ ì˜ë„ë¥¼ 20ì ë‚´ì™¸ì˜ ì§§ì€ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•´ ì£¼ì„¸ìš”."
)
```

* **ì¥ì **

  * ì‚¬ì „ ì •ì˜í•˜ì§€ ì•Šì€ ìˆ˜ë§ì€ ì˜ë„ì— ëŒ€í•´ ìœ ì—°í•œ ëŒ€ì‘ ê°€ëŠ¥
  * ì‚¬ìš©ì ì§ˆì˜ì˜ ë””í…Œì¼ì„ ì˜ ë°˜ì˜í•  ìˆ˜ ìˆìŒ.

* **ë‹¨ì **

  * ìƒì„±ëœ ì˜ë„ë¥¼ í›„ì† ì‹œìŠ¤í…œì— ë§¤í•‘í•˜ë ¤ë©´ ì¶”ê°€ ì²˜ë¦¬ê°€ í•„ìš”í•  ìˆ˜ ìˆìŒ.

---

### 2ï¸âƒ£ **í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ (Hybrid Intent Detection)**

* **ê°œë…**

  * íì‡„í˜• ë¶„ë¥˜ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ë˜, `"ê¸°íƒ€"` ë²”ì£¼ì¼ ê²½ìš° ê°œë°©í˜•ìœ¼ë¡œ ì¶”ê°€ë¡œ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•.
  * ì¦‰, ë¯¸ë¦¬ ì •ì˜ëœ ì˜ë„ì¼ ê²½ìš°ì—” ì •í•´ì§„ ë ˆì´ë¸”ì„ ì‚¬ìš©í•˜ê³ , ì•„ë‹Œ ê²½ìš°ì—” ì˜ë„ë¥¼ ë” êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•˜ë„ë¡ ëª¨ë¸ì´ ìƒì„±í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

* **ì˜ˆì‹œ**

```python
def llama3_intent_classifier_hybrid(prompt: str) -> dict:
    system_prompt = (
        "ë‹¤ìŒ ì§ˆë¬¸ì˜ ì˜ë„ë¥¼ 'ì—¬í–‰ì˜ˆì•½', 'í˜¸í…”ì˜ˆì•½', 'ì‹ë‹¹ì˜ˆì•½', 'í•­ê³µì˜ˆì•½', 'ê¸°íƒ€' ì¤‘ í•˜ë‚˜ë¡œ ìš°ì„  ë¶„ë¥˜í•˜ê³ , "
        "'ê¸°íƒ€'ì¸ ê²½ìš°ì—ëŠ” ì˜ë„ë¥¼ 20ì ë‚´ì™¸ë¡œ ê°„ëµí•˜ê²Œ ìš”ì•½í•´ì£¼ì„¸ìš”.\n"
        "ê²°ê³¼ëŠ” JSONìœ¼ë¡œ {\"intent\": \"ë¶„ë¥˜ê²°ê³¼\", \"detail\": \"ê¸°íƒ€ ì˜ë„ì¸ ê²½ìš°ì˜ ìš”ì•½(ì—†ìœ¼ë©´ ë¹ˆë¬¸ìì—´)\"} ë¡œ ë‹µë³€í•˜ì„¸ìš”."
    )

    response = ollama.chat(
        model="llama3-local",
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": prompt},
        ]
    )

    try:
        intent_json = json.loads(response['message']['content'])
        return intent_json
    except json.JSONDecodeError:
        return {'intent': 'ê¸°íƒ€', 'detail': ''}
```

* **ì¥ì **

  * ì‚¬ì „ì— ì •ì˜ëœ ì˜ë„ëŠ” ëª…í™•í•˜ê²Œ ê´€ë¦¬ë˜ë©´ì„œ, ìƒˆë¡œìš´ ìœ í˜•ì˜ ì§ˆì˜ë„ ë¹ ë¥´ê²Œ ì‹ë³„ ê°€ëŠ¥
  * í˜„ì‹¤ì ì¸ ì„œë¹„ìŠ¤ ìš´ì˜ì— ê°€ì¥ ì í•©í•œ ë°©ì‹

* **ë‹¨ì **

  * ì•½ê°„ì˜ ì¶”ê°€ ì²˜ë¦¬ ì˜¤ë²„í—¤ë“œ

---

### 3ï¸âƒ£ **ì„ë² ë”© ê¸°ë°˜ ì˜ë„ ìœ ì‚¬ë„ ë¶„ë¥˜ (Semantic Similarity)**

* **ê°œë…**

  * ì„ë² ë”©ì„ í™œìš©í•´ ì‚¬ìš©ì ì…ë ¥ê³¼ ì‚¬ì „ì— ì¤€ë¹„í•œ ìƒ˜í”Œ ë¬¸ì¥ê³¼ì˜ ìœ ì‚¬ë„ë¥¼ ê³„ì‚°í•˜ì—¬, ê°€ì¥ ê°€ê¹Œìš´ ì˜ë„ë¥¼ ë™ì ìœ¼ë¡œ ì°¾ì•„ë‚´ëŠ” ë°©ë²•.

* **íë¦„**

  * ì‚¬ìš©ìì˜ ì§ˆë¬¸ â†’ ì„ë² ë”© ë²¡í„° ë³€í™˜ â†’ ì‚¬ì „ì— ì •ì˜ëœ ì˜ë„ë³„ ëŒ€í‘œ ì§ˆë¬¸ ë¬¸ì¥ê³¼ ìœ ì‚¬ë„ ë¹„êµ â†’ ê°€ì¥ ë†’ì€ ìœ ì‚¬ë„ë¥¼ ê°€ì§„ ì˜ë„ í• ë‹¹ ë˜ëŠ” ì¼ì • threshold ì´í•˜ì¼ ê²½ìš° "ìƒˆë¡œìš´ ì˜ë„"ë¡œ ê°„ì£¼.

* **ì¥ì **

  * íŠ¹ì • ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬ê°€ ë§ì•„ë„ ì‰½ê²Œ í™•ì¥ ê°€ëŠ¥
  * ìƒˆë¡œìš´ ì§ˆë¬¸ ìœ í˜• ë“±ì¥ ì‹œ ìœ ì‚¬ë„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìë™ ì²˜ë¦¬ ê°€ëŠ¥

* **ë‹¨ì **

  * ì˜ë„ ê°„ ê²½ê³„ê°€ ëª¨í˜¸í•  ìˆ˜ ìˆìŒ
  * ì„ë² ë”© ëª¨ë¸ ë° threshold ê´€ë¦¬ í•„ìš”

* **ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬**

  * OpenAI Embeddings API, Sentence-BERT, Cohere Embeddings ë“±.

```python
import numpy as np
from sklearn.metrics.pairwise import cosine_similarity
from sentence_transformers import SentenceTransformer

model = SentenceTransformer('all-MiniLM-L6-v2')

intents = {
    "í˜¸í…”ì˜ˆì•½": ["í˜¸í…” ì¡ì•„ì¤˜", "í˜¸í…” ì˜ˆì•½í•´ì¤˜"],
    "ì‹ë‹¹ì˜ˆì•½": ["ë§›ì§‘ ì˜ˆì•½", "ì‹ë‹¹ ìë¦¬ ì˜ˆì•½"],
    # ê¸°íƒ€ ì˜ë„ ì¶”ê°€ ê°€ëŠ¥
}

intent_embeddings = {intent: np.mean(model.encode(examples), axis=0) for intent, examples in intents.items()}

def classify_semantic_intent(user_input):
    user_embedding = model.encode([user_input])[0]
    scores = {intent: cosine_similarity([user_embedding], [emb])[0][0] for intent, emb in intent_embeddings.items()}
    best_intent, best_score = max(scores.items(), key=lambda x: x[1])
    
    threshold = 0.7
    if best_score < threshold:
        return "ê¸°íƒ€"
    return best_intent
```

---

## ğŸš© ë°©ë²•ë³„ ì¶”ì²œ ìš©ë„ ë° ë¹„êµ

| ë°©ë²•    | ì¥ì            | ë‹¨ì                       | ì¶”ì²œ              |
| ----- | ------------ | ----------------------- | --------------- |
| íì‡„í˜•   | ë¹ ë¥´ê³  ì •í™•       | ì œí•œì ì¸ ë²”ìœ„                 | ì˜ë„ê°€ ëª…í™•íˆ ì œí•œëœ ì„œë¹„ìŠ¤ |
| ê°œë°©í˜•   | ìœ ì—°í•œ ëŒ€ì‘ ê°€ëŠ¥    | ë¶„ë¥˜ ê´€ë¦¬ê°€ ì–´ë ¤ì›€              | ììœ ë¡­ê³  ë‹¤ì–‘í•œ ì§ˆë¬¸ì²˜ë¦¬   |
| í•˜ì´ë¸Œë¦¬ë“œ | íš¨ìœ¨ê³¼ ìœ ì—°ì„±ì˜ ê· í˜•  | ì¶”ê°€ ì²˜ë¦¬ í•„ìš”                | í˜„ì‹¤ì  ìš´ì˜ ì„œë¹„ìŠ¤      |
| ì„ë² ë”©ê¸°ë°˜ | í™•ì¥ì„±, ìœ ì§€ë³´ìˆ˜ í¸ë¦¬ | ëª¨í˜¸í•œ ê²½ê³„, threshold ì¡°ì • í•„ìš” | ì¹´í…Œê³ ë¦¬ê°€ ë§ì„ ê²½ìš°     |

---

## ğŸ¯ **í˜„ì‹¤ì ìœ¼ë¡œ ì¶”ì²œí•˜ëŠ” ë°©ë²•**

* ì´ˆê¸° ìš´ì˜ë‹¨ê³„ì—ì„œëŠ” **í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹**ì´ ê°€ì¥ íš¨ìœ¨ì ì…ë‹ˆë‹¤.

  * ì£¼ìš” ì¹´í…Œê³ ë¦¬ëŠ” ì •í™•íˆ ê´€ë¦¬í•˜ë©´ì„œ, ì˜ˆì¸¡í•˜ì§€ ëª»í•œ ì§ˆë¬¸ë„ ìì—°ìŠ¤ëŸ½ê²Œ ëŒ€ì‘ ê°€ëŠ¥

* ì¥ê¸°ì ìœ¼ë¡œëŠ” **ì„ë² ë”© ê¸°ë°˜ ë¶„ë¥˜**ê°€ í™•ì¥ì„±ì´ ì¢‹ìœ¼ë©°, ì¶”ê°€ì ì¸ intent ê´€ë¦¬ê°€ ì‰¬ì›Œ ì¶”ì²œí•©ë‹ˆë‹¤.

---

ì´ëŸ¬í•œ ë°©ë²• ì¤‘ ì„œë¹„ìŠ¤ì˜ ëª©í‘œì™€ ìƒí™©ì— ë”°ë¼ ê°€ì¥ ì í•©í•œ ë°©ì‹ì„ ì„ íƒí•˜ì—¬ ì ìš©í•˜ë©´ ë³´ë‹¤ ìœ ì—°í•˜ê³  íš¨ê³¼ì ìœ¼ë¡œ ì˜ë„ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

>>> ì˜ë„ì— ë”°ë¥¸ ë™ì‘ì„ ë”°ë¡œ ì •ì˜í•´ë‘˜ê»€ë°, ì´ê²Œ ë‚´ìš©ì´ ê½¤ ë§ê³ , ì ˆì°¨ê°€ í•„ìš”í•œ ë¶€ë¶„ë„ ìˆê³ , ë‹¨ê³„ ì €ì¥ì´ í•„ìš”í•  ìˆ˜ ìˆì–´. ì´ ë§ê³  ë³µì¡í•œ ë‚´ìš©ë“¤ì„ ì–´ë–»ê²Œ ê´€ë¦¬í•˜ëŠ”ê²Œ ì¢‹ì„ê¹Œ


ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ë”°ë¼ **ì˜ë„ë¥¼ ë¶„ë¥˜í•œ í›„**, ê° ì˜ë„ì— ëŒ€ì‘ë˜ëŠ” **ë³µì¡í•œ ë™ì‘, ì ˆì°¨, ìƒíƒœ ê´€ë¦¬**ë¥¼ ì˜ ì²˜ë¦¬í•˜ë ¤ë©´ ì•„ë˜ì™€ ê°™ì€ êµ¬ì¡°ì  ì„¤ê³„ê°€ í•„ìš”í•©ë‹ˆë‹¤:

---

## âœ… ëª©í‘œ ìš”ì•½

* ì˜ë„(intent)ì— ë”°ë¼ ê°ê¸° ë‹¤ë¥¸ **ë™ì‘ ì‹œë‚˜ë¦¬ì˜¤(task flow)** ì‹¤í–‰
* ì‹œë‚˜ë¦¬ì˜¤ëŠ” \*\*ë³µì¡í•œ ì ˆì°¨ì™€ ë‹¨ê³„(step)\*\*ë¡œ êµ¬ì„±ë¨
* ì‚¬ìš©ìì˜ ì‘ë‹µì— ë”°ë¼ **ìƒíƒœ ì €ì¥ ë° ë³µì›**ì´ í•„ìš”í•¨
* ë‹¤êµ­ì–´, ì˜¨ë””ë°”ì´ìŠ¤/ì„œë²„ ë¶„ì‚° ì²˜ë¦¬ê¹Œì§€ ê³ ë ¤ë¨

---

## ğŸ’¡ ì¶”ì²œ êµ¬ì¡°

### ğŸ”· 1. **LangGraph ê¸°ë°˜ FSM (ìƒíƒœë¨¸ì‹ ) ì•„í‚¤í…ì²˜**

LangGraphëŠ” ë³µì¡í•œ íë¦„ê³¼ ìƒíƒœ ì €ì¥, ë¶„ê¸° ì²˜ë¦¬ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì§€ì›í•©ë‹ˆë‹¤. ì•„ë˜ì²˜ëŸ¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

#### \[1ë‹¨ê³„] ì˜ë„ ë¶„ë¥˜ ë…¸ë“œ

* ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ `intent`ë¥¼ ê²°ì •
* ì˜ˆ: `í•­ê³µì˜ˆì•½`, `í˜¸í…”ì˜ˆì•½`, `ê¸°íƒ€`

#### \[2ë‹¨ê³„] ì˜ë„ì— ë”°ë¥¸ ì„œë¸Œê·¸ë˜í”„ ì§„ì…

* `router` ë…¸ë“œë¥¼ í†µí•´ intentë³„ë¡œ ë¶„ê¸°
* ê° intentëŠ” ë…ë¦½ì ì¸ ìƒíƒœê¸°ê³„ë¡œ ë™ì‘

#### \[3ë‹¨ê³„] ì ˆì°¨ë³„ ë‹¨ê³„ ë…¸ë“œ êµ¬ì„±

* ì˜ˆ: `ì¶œë°œì§€ ì…ë ¥ â†’ ë„ì°©ì§€ ì…ë ¥ â†’ ë‚ ì§œ ì„ íƒ â†’ í•­ê³µí¸ ì œì•ˆ`

#### \[4ë‹¨ê³„] ìƒíƒœ ì €ì¥ ë° ë³µì›

* ê° ë‹¨ê³„ëŠ” AgentStateì— ì €ì¥ë¨
* LangGraphëŠ” ì´ êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ì¤‘í„´ ëŒ€í™” ì§€ì›

---

### ğŸ”¶ 2. **ì˜ë„ë³„ Task Flow ì •ì˜ ë°©ë²•**

ì˜ë„ì— ë”°ë¥¸ ë™ì‘ì„ **ì½”ë“œì™€ ë°ì´í„° ë¶„ë¦¬**í•´ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤:

```python
# JSON ë˜ëŠ” YAMLë¡œ ì •ì˜
{
  "í•­ê³µì˜ˆì•½": {
    "steps": [
      {"name": "ì¶œë°œì§€", "prompt": "ì¶œë°œì§€ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”."},
      {"name": "ë„ì°©ì§€", "prompt": "ë„ì°©ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."},
      {"name": "ì¶œë°œì¼", "prompt": "ì¶œë°œ ë‚ ì§œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”."},
      {"name": "ìŠ¹ê° ìˆ˜", "prompt": "íƒ‘ìŠ¹ ì¸ì› ìˆ˜ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”."}
    ]
  },
  "í˜¸í…”ì˜ˆì•½": {
    "steps": [
      {"name": "ì§€ì—­", "prompt": "ìˆ™ë°• ì§€ì—­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."},
      {"name": "ì²´í¬ì¸", "prompt": "ì²´í¬ì¸ ë‚ ì§œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”."},
      {"name": "ì²´í¬ì•„ì›ƒ", "prompt": "ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ì•Œë ¤ì£¼ì„¸ìš”."}
    ]
  }
}
```

ì´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ LangGraph ë…¸ë“œë¥¼ **ë™ì ìœ¼ë¡œ ìƒì„±**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### ğŸ”· 3. **ìƒíƒœ ì €ì¥ ë° ë‹¤ì¤‘í„´ ì²˜ë¦¬ ì˜ˆì‹œ**

```python
class AgentState(TypedDict):
    prompt: str
    intent: str
    step_index: int
    slots: dict
```

* `intent`: í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì‹œë‚˜ë¦¬ì˜¤
* `step_index`: í˜„ì¬ ë‹¨ê³„
* `slots`: ì‚¬ìš©ì ì‘ë‹µì„ ì €ì¥í•˜ëŠ” í•„ë“œ

â†’ LangGraphëŠ” ê° ë‹¨ê³„ì—ì„œ `step_index += 1` í•˜ë©° ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë„˜ì–´ê°

---

### ğŸ”· 4. **ì˜ˆì‹œ íë¦„ êµ¬ì¡°**

```
[ì‚¬ìš©ìì…ë ¥]
    â†“
[intent_classifier]
    â†“
[router]
 â”œâ”€ í•­ê³µì˜ˆì•½ ì„œë¸Œê·¸ë˜í”„ (ì¶œë°œì§€ â†’ ë„ì°©ì§€ â†’ ë‚ ì§œ â†’ í•­ê³µí¸ ì œì•ˆ)
 â””â”€ í˜¸í…”ì˜ˆì•½ ì„œë¸Œê·¸ë˜í”„ (ì§€ì—­ â†’ ì²´í¬ì¸ â†’ ì²´í¬ì•„ì›ƒ)
```

ê° ë…¸ë“œëŠ” ì‚¬ìš©ì ì…ë ¥ì„ ë°›ê³  ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ë©° ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•©ë‹ˆë‹¤.

---

## ğŸ“¦ ê¸°ìˆ  ìŠ¤íƒ êµ¬ì„± ì œì•ˆ

| ìš”ì†Œ        | ê¸°ìˆ                                   |
| --------- | ----------------------------------- |
| ì˜ë„ ë¶„ë¥˜     | Ollama + LLM                        |
| ìƒíƒœë¨¸ì‹       | LangGraph                           |
| ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜   | JSON, YAML (í”ŒëŸ¬ê·¸ì¸ ê°€ëŠ¥í•˜ê²Œ)              |
| ìƒíƒœ ì €ì¥     | LangGraphì˜ ìƒíƒœ ë”•ì…”ë„ˆë¦¬ ë˜ëŠ” Redis ë“± ì™¸ë¶€ ì €ì¥ |
| ë©€í‹°í„´ ëŒ€í™” ìœ ì§€ | í´ë¼ì´ì–¸íŠ¸ì—ì„œ UUID ê¸°ë°˜ ì„¸ì…˜ ì €ì¥ or ì„œë²„ ì„¸ì…˜ ê´€ë¦¬   |
| ì˜¨ë””ë°”ì´ìŠ¤ ì²˜ë¦¬  | MobileBERT / TinyLLaMA ë“±            |
| ì„œë²„ ì—°ì‚°     | Ollama ë˜ëŠ” OpenAI / Cohere ë“±         |

---

## ğŸ§  ìš”ì•½

* **LangGraph**ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì˜ë„ë³„ FSMì„ êµ¬ì„±
* ê° ì˜ë„ëŠ” **JSON ë˜ëŠ” YAML**ë¡œ ì •ì˜ëœ ì ˆì°¨ì— ë”°ë¼ ì²˜ë¦¬
* **ìƒíƒœëŠ” ì§€ì†ì ìœ¼ë¡œ ì €ì¥**, ë‹¤ì¤‘í„´ì—ì„œ ì´ì–´ì§
* **í•˜ì´ë¸Œë¦¬ë“œ ì²˜ë¦¬** (ì˜¨ë””ë°”ì´ìŠ¤ëŠ” intentê¹Œì§€, ì„œë²„ëŠ” ë³µì¡í•œ ì ˆì°¨ ì²˜ë¦¬)
* ì´ ë°©ì‹ì€ í™•ì¥ì„±, ìœ ì§€ë³´ìˆ˜ì„±, ì‚¬ìš©ì ê²½í—˜ ëª¨ë‘ ê³ ë ¤í•œ êµ¬ì¡°ì…ë‹ˆë‹¤.

---

ì›í•˜ì‹ ë‹¤ë©´ ì•„ë˜ì²˜ëŸ¼ ìƒ˜í”Œ êµ¬í˜„ ì½”ë“œë¥¼ ì‹¤ì œë¡œ ì‘ì„±í•´ë“œë¦´ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

1. `í•­ê³µì˜ˆì•½` ì‹œë‚˜ë¦¬ì˜¤ì˜ LangGraph ì •ì˜
2. ì‹œë‚˜ë¦¬ì˜¤ JSON ë¡œë”© ë° ìë™ ê·¸ë˜í”„ ìƒì„± ì½”ë“œ
3. ìƒíƒœ ì €ì¥ê³¼ ì¤‘ë‹¨/ë³µì› ì˜ˆì‹œ

í•„ìš”í•˜ì‹œë©´ ì–´ë–¤ ì˜ë„ë¶€í„° ë¨¼ì € êµ¬í˜„í• ì§€ ì•Œë ¤ì£¼ì„¸ìš” ğŸ˜Š

---

>>> ìë™ì°¨ ìš´ì „ì— ëŒ€í•œ ë‚´ìš©ì„ ì˜ˆì‹œë¡œ ë“¤ì–´ì„œ í•´ì¤˜. ì‹œë™ ê±°ëŠ”ê²ƒ ë¶€í„° ìš´ì „ ë° ì£¼ì°¨ê¹Œì§€. ê·¸ë¦¬ê³  ìš´ì „ì¤‘ì— ë°œìƒí•˜ëŠ” ì˜ˆì™¸ ìƒí™© í˜¹ì€ ìœ„ê¸°ìƒí™© ë“±ì— ëŒ€í•œ ëŒ€ì²˜ë“± ìµœëŒ€í•œ ë§ì€ ë¶€ë¶„ì„ ê³ ë ¤í•´ì„œ ì‘ì„±í•´ì¤˜


ì¢‹ìŠµë‹ˆë‹¤! ìë™ì°¨ ìš´ì „ì´ë¼ëŠ” ì£¼ì œë¥¼ ê¸°ë°˜ìœ¼ë¡œ **LangGraphë¥¼ í™œìš©í•œ ì ˆì°¨í˜• AI Agent ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì œ**ë¥¼ ì•„ë˜ì— ì •ë¦¬í•´ë“œë¦´ê²Œìš”. ì´ ì˜ˆì œëŠ”:

1. ì‹œë™ â†’ ì£¼í–‰ â†’ ì£¼ì°¨ê¹Œì§€ì˜ ê¸°ë³¸ ìš´ì „ í”Œë¡œìš°
2. ìš´ì „ ì¤‘ ë°œìƒ ê°€ëŠ¥í•œ ì˜ˆì™¸ ìƒí™© ë° ìœ„ê¸° ëŒ€ì‘
3. ìƒíƒœ ê¸°ë°˜ ë‹¤ì¤‘í„´ ëŒ€í™” íë¦„ (LangGraph êµ¬ì¡°)
4. ê° ë‹¨ê³„ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê¸° ìœ„í•œ JSON ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì„±

---

## ğŸš˜ ìë™ì°¨ ìš´ì „ ì‹œë‚˜ë¦¬ì˜¤ í”Œë¡œìš° (ìƒì„¸ ì ˆì°¨)

### ğŸ’¡ ì£¼ìš” Intent

* `ì‹œë™ê±¸ê¸°`
* `ìš´ì „ ì‹œì‘í•˜ê¸°`
* `ìš´ì „ ì¤‘ ì˜ˆì™¸ ìƒí™© ì²˜ë¦¬`
* `ì£¼ì°¨í•˜ê¸°`

---

## ğŸ”§ 1. ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜ (JSON ê¸°ë°˜ ì˜ˆì‹œ)

```json
{
  "ìš´ì „ì‹œë‚˜ë¦¬ì˜¤": {
    "steps": [
      { "name": "ì‹œë™", "prompt": "ìë™ì°¨ì— íƒ€ì…¨ë‚˜ìš”? ì‹œë™ì„ ê±¸ì–´ì£¼ì„¸ìš”. ì‹œë™ì´ ê±¸ë ¸ìœ¼ë©´ 'ì‹œë™ ì™„ë£Œ'ë¼ê³  ë§ì”€í•´ì£¼ì„¸ìš”." },
      { "name": "ì•ˆì „ë²¨íŠ¸", "prompt": "ì•ˆì „ë²¨íŠ¸ë¥¼ ì°©ìš©í•˜ì…¨ë‚˜ìš”?" },
      { "name": "ê¸°ì–´ë³€ê²½", "prompt": "ê¸°ì–´ë¥¼ 'P'ì—ì„œ 'D'ë¡œ ë°”ê¾¸ì„¸ìš”. ì™„ë£Œë˜ë©´ ì•Œë ¤ì£¼ì„¸ìš”." },
      { "name": "ì£¼í–‰ì‹œì‘", "prompt": "ì´ì œ ì¶œë°œí•˜ì‹¤ ìˆ˜ ìˆì–´ìš”. ì²œì²œíˆ ì¶œë°œí•˜ì„¸ìš”." },
      { "name": "êµì°¨ë¡œì§„ì…", "prompt": "êµì°¨ë¡œê°€ ë³´ì´ë©´ ì¢Œìš°ë¥¼ ì‚´í•€ í›„ ì§„ì…í•˜ì„¸ìš”." },
      { "name": "ì°¨ì„ ë³€ê²½", "prompt": "ì°¨ì„ ì„ ë³€ê²½í•´ì•¼ í•˜ë‚˜ìš”? ë°©í–¥ì§€ì‹œë“±ì„ ì¼°ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”." },
      { "name": "ì£¼ì°¨ë‹¨ê³„", "prompt": "ë„ì°©í•˜ì…¨ë‚˜ìš”? ì£¼ì°¨ë¥¼ ì‹œì‘í•´ ì£¼ì„¸ìš”. ì™„ë£Œë˜ë©´ ì•Œë ¤ì£¼ì„¸ìš”." },
      { "name": "ì‹œë™ë„ê¸°", "prompt": "ê¸°ì–´ë¥¼ 'P'ë¡œ ì˜®ê¸°ê³ , ì‹œë™ì„ ë„ì„¸ìš”. 'ìš´ì „ ì™„ë£Œ'ë¼ê³  ì…ë ¥í•´ì£¼ì„¸ìš”." }
    ],
    "exceptions": [
      {
        "name": "ì—”ì§„ê²½ê³ ë“±",
        "trigger": ["ì—”ì§„ ê²½ê³ ë“±", "ì²´í¬ ì—”ì§„"],
        "response": "ì—”ì§„ ê²½ê³ ë“±ì´ ì¼œì¡Œë‹¤ë©´ ì°¨ëŸ‰ì„ ì •ì°¨í•˜ê³  ì •ë¹„ì†Œì— ì—°ë½í•˜ì„¸ìš”."
      },
      {
        "name": "íƒ€ì´ì–´ í‘í¬",
        "trigger": ["íƒ€ì´ì–´", "í‘í¬", "ë°”ëŒ ë¹ ì§"],
        "response": "ë¹„ìƒë“±ì„ ì¼œê³  ì•ˆì „í•œ ê³³ì— ì •ì°¨í•œ í›„, ìŠ¤í˜ì–´ íƒ€ì´ì–´ë¡œ êµì²´í•˜ê±°ë‚˜ ë³´í—˜ì‚¬ì— ì—°ë½í•˜ì„¸ìš”."
      },
      {
        "name": "ë¸Œë ˆì´í¬ ê³ ì¥",
        "trigger": ["ë¸Œë ˆì´í¬", "ë©ˆì¶”ì§€ ì•ŠìŒ"],
        "response": "ë¸Œë ˆì´í¬ê°€ ì‘ë™í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ì–´ë¥¼ ë‚®ì¶”ê³  ì‚¬ì´ë“œ ë¸Œë ˆì´í¬ë¥¼ ì²œì²œíˆ ì‘ë™ì‹œì¼œ ì°¨ëŸ‰ì„ ë©ˆì¶”ì„¸ìš”. ì¦‰ì‹œ ì •ë¹„ê°€ í•„ìš”í•©ë‹ˆë‹¤."
      }
    ]
  }
}
```

---

## ğŸ§  2. LangGraph ê¸°ë°˜ ì‹¤í–‰ íë¦„ (êµ¬ì„±ë„)

```plaintext
[User Input]
     â†“
[intent_classifier]
     â†“
[router]
 â”œâ”€ ì‹œë™ê±¸ê¸° ì‹œë‚˜ë¦¬ì˜¤ â†’ ì‹œë™ ë‹¨ê³„ ì§„í–‰
 â”œâ”€ ìš´ì „ ì‹œì‘ â†’ ê° ì£¼í–‰ ë‹¨ê³„ ì§„í–‰
 â”œâ”€ ìœ„ê¸°ìƒí™© ì¸ì‹ â†’ ì˜ˆì™¸ í•¸ë“¤ë§ ë‹¨ê³„ë¡œ ë¶„ê¸°
 â””â”€ ì£¼ì°¨ ì‹œë‚˜ë¦¬ì˜¤ â†’ ì¢…ë£Œ ì ˆì°¨
```

---

## ğŸ› ï¸ 3. LangGraph ì˜ˆì œ ì½”ë“œ (Python + Ollama)

```python
from langgraph.graph import StateGraph, END
from typing import TypedDict, List
import json
import ollama

# ìƒíƒœ í´ë˜ìŠ¤ ì •ì˜
class AgentState(TypedDict):
    step_index: int
    intent: str
    slots: dict
    prompt: str

# ìš´ì „ ì‹œë‚˜ë¦¬ì˜¤ ë¶ˆëŸ¬ì˜¤ê¸°
with open('driving_scenario.json', 'r', encoding='utf-8') as f:
    scenario_data = json.load(f)['ìš´ì „ì‹œë‚˜ë¦¬ì˜¤']

# ì˜ˆì™¸ ì²˜ë¦¬ ê·œì¹™
exception_rules = scenario_data['exceptions']

def detect_exception(user_input: str) -> str:
    for rule in exception_rules:
        for trig in rule['trigger']:
            if trig in user_input:
                return rule['response']
    return ""

# ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰
def next_step(state: AgentState) -> AgentState:
    step_idx = state.get("step_index", 0)
    steps = scenario_data["steps"]

    if step_idx >= len(steps):
        return {**state, "prompt": "ìš´ì „ ì‹œë‚˜ë¦¬ì˜¤ê°€ ëª¨ë‘ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", "step_index": step_idx}

    next_prompt = steps[step_idx]["prompt"]
    return {
        **state,
        "prompt": next_prompt,
        "step_index": step_idx + 1
    }

# ì˜ˆì™¸ íƒì§€ ë° ë¶„ê¸° ì²˜ë¦¬
def handle_input(state: AgentState) -> AgentState:
    user_response = state["slots"].get("user_input", "")
    emergency = detect_exception(user_response)
    
    if emergency:
        return {**state, "prompt": f"[ìœ„ê¸° ìƒí™© ê°ì§€] {emergency}"}
    return next_step(state)

# ê·¸ë˜í”„ ì •ì˜
graph = StateGraph(AgentState)
graph.add_node("step_executor", handle_input)
graph.set_entry_point("step_executor")
graph.add_edge("step_executor", END)

app = graph.compile()

# ì‹¤í–‰ ì˜ˆì‹œ
if __name__ == "__main__":
    state = AgentState(intent="ìš´ì „ì‹œë‚˜ë¦¬ì˜¤", step_index=0, slots={}, prompt="")
    while True:
        state = app.invoke(state)
        print(state['prompt'])

        if "ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤" in state["prompt"]:
            break

        user_input = input("â†’ ")
        state["slots"]["user_input"] = user_input
```

---

## ğŸ“Œ ê²°ê³¼ ì˜ˆì‹œ

```
ìë™ì°¨ì— íƒ€ì…¨ë‚˜ìš”? ì‹œë™ì„ ê±¸ì–´ì£¼ì„¸ìš”. ì‹œë™ì´ ê±¸ë ¸ìœ¼ë©´ 'ì‹œë™ ì™„ë£Œ'ë¼ê³  ë§ì”€í•´ì£¼ì„¸ìš”.
â†’ ì‹œë™ ì™„ë£Œ
ì•ˆì „ë²¨íŠ¸ë¥¼ ì°©ìš©í•˜ì…¨ë‚˜ìš”?
â†’ ë„¤
ê¸°ì–´ë¥¼ 'P'ì—ì„œ 'D'ë¡œ ë°”ê¾¸ì„¸ìš”. ì™„ë£Œë˜ë©´ ì•Œë ¤ì£¼ì„¸ìš”.
â†’ ì™„ë£Œ
...
â†’ ì—”ì§„ ê²½ê³ ë“±ì´ ì¼œì¡Œì–´ìš”
[ìœ„ê¸° ìƒí™© ê°ì§€] ì—”ì§„ ê²½ê³ ë“±ì´ ì¼œì¡Œë‹¤ë©´ ì°¨ëŸ‰ì„ ì •ì°¨í•˜ê³  ì •ë¹„ì†Œì— ì—°ë½í•˜ì„¸ìš”.
```

---

## ğŸ“¦ í™•ì¥ ì•„ì´ë””ì–´

| í™•ì¥ ìš”ì†Œ           | ì„¤ëª…                         |
| --------------- | -------------------------- |
| ğŸ“ ì§€ë„ ê¸°ë°˜ ì²˜ë¦¬     | GPS ì—°ë™í•˜ì—¬ ìš´ì „ ê²½ë¡œ ì•ˆë‚´          |
| ğŸ“Š ì˜ˆì™¸ í†µê³„ ê´€ë¦¬     | ìœ„ê¸° ìƒí™© ëŒ€ì‘ í†µê³„ ìë™ ìˆ˜ì§‘          |
| ğŸ§  ì‚¬ìš©ì ë§ì¶¤í˜• ì‘ë‹µ   | ìš´ì „ì ë ˆë²¨(ì´ˆë³´/ìˆ™ë ¨ì)ì— ë”°ë¼ í”„ë¡¬í”„íŠ¸ ë³€ê²½ |
| ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° | íŠ¹ì • ì‹œë‚˜ë¦¬ì˜¤ ìƒíƒœ ì €ì¥ í›„ ì´ì–´ì„œ ì§„í–‰     |

---

í•„ìš”í•˜ì‹œë©´ ì´ ì˜ˆì œë¥¼ ê¸°ë°˜ìœ¼ë¡œ:

* YAML ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ ìë™ ë³€í™˜
* ë‹¤êµ­ì–´ ì§€ì› ì¶”ê°€
* FastAPI + Ollama ì„œë²„í™”

ë“±ë„ êµ¬í˜„ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì–´ëŠ ë¶€ë¶„ë¶€í„° í™•ì¥í•˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?

---

>>> ì´ê±° ëª¨ë‘ í•´ì¤˜
>>> - YAML ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ ìë™ ë³€í™˜
>>> -  ë‹¤êµ­ì–´ ì§€ì› ì¶”ê°€
>>> - FastAPI + Ollama ì„œë²„í™”

ì¢‹ìŠµë‹ˆë‹¤! ìš”ì²­í•˜ì‹  ì „ì²´ êµ¬ì„±ì€ ì•„ë˜ì™€ ê°™ì€ ì„¸ ê°€ì§€ íŒŒíŠ¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤:

---

## âœ… ì „ì²´ êµ¬ì„± ìš”ì•½

| ê¸°ëŠ¥                  | êµ¬í˜„ ì„¤ëª…                                          |
| ------------------- | ---------------------------------------------- |
| 1ï¸âƒ£ YAML ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ ë³€í™˜ | `.yaml` íŒŒì¼ë¡œ ì ˆì°¨/ì˜ˆì™¸ ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜ í›„ Pythonì—ì„œ ìë™ ë¡œë”©     |
| 2ï¸âƒ£ ë‹¤êµ­ì–´ ì§€ì›          | ì‚¬ìš©ì ì–¸ì–´ ì„¤ì •ì— ë”°ë¼ í”„ë¡¬í”„íŠ¸ ì¶œë ¥ ë³€ê²½ (ì˜ˆ: í•œêµ­ì–´, ì˜ì–´)          |
| 3ï¸âƒ£ FastAPI ì„œë²„í™”     | Ollamaì™€ LangGraphë¥¼ ë°±ì—”ë“œ ì„œë²„ í˜•íƒœë¡œ ì‹¤í–‰í•˜ì—¬ REST API ì œê³µ |

---

## 1ï¸âƒ£ YAML ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì¡° ì˜ˆì‹œ (`driving_scenario.yaml`)

```yaml
languages:
  ko:
    steps:
      - name: ì‹œë™
        prompt: "ìë™ì°¨ì— íƒ€ì…¨ë‚˜ìš”? ì‹œë™ì„ ê±¸ì–´ì£¼ì„¸ìš”. ì‹œë™ì´ ê±¸ë ¸ìœ¼ë©´ 'ì‹œë™ ì™„ë£Œ'ë¼ê³  ë§ì”€í•´ì£¼ì„¸ìš”."
      - name: ì•ˆì „ë²¨íŠ¸
        prompt: "ì•ˆì „ë²¨íŠ¸ë¥¼ ì°©ìš©í•˜ì…¨ë‚˜ìš”?"
      - name: ê¸°ì–´ë³€ê²½
        prompt: "ê¸°ì–´ë¥¼ 'P'ì—ì„œ 'D'ë¡œ ë°”ê¾¸ì„¸ìš”. ì™„ë£Œë˜ë©´ ì•Œë ¤ì£¼ì„¸ìš”."
      - name: ì£¼í–‰ì‹œì‘
        prompt: "ì´ì œ ì¶œë°œí•˜ì‹¤ ìˆ˜ ìˆì–´ìš”. ì²œì²œíˆ ì¶œë°œí•˜ì„¸ìš”."
      - name: êµì°¨ë¡œì§„ì…
        prompt: "êµì°¨ë¡œê°€ ë³´ì´ë©´ ì¢Œìš°ë¥¼ ì‚´í•€ í›„ ì§„ì…í•˜ì„¸ìš”."
      - name: ì°¨ì„ ë³€ê²½
        prompt: "ì°¨ì„ ì„ ë³€ê²½í•´ì•¼ í•˜ë‚˜ìš”? ë°©í–¥ì§€ì‹œë“±ì„ ì¼°ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”."
      - name: ì£¼ì°¨ë‹¨ê³„
        prompt: "ë„ì°©í•˜ì…¨ë‚˜ìš”? ì£¼ì°¨ë¥¼ ì‹œì‘í•´ ì£¼ì„¸ìš”. ì™„ë£Œë˜ë©´ ì•Œë ¤ì£¼ì„¸ìš”."
      - name: ì‹œë™ë„ê¸°
        prompt: "ê¸°ì–´ë¥¼ 'P'ë¡œ ì˜®ê¸°ê³ , ì‹œë™ì„ ë„ì„¸ìš”. 'ìš´ì „ ì™„ë£Œ'ë¼ê³  ì…ë ¥í•´ì£¼ì„¸ìš”."

    exceptions:
      - name: ì—”ì§„ê²½ê³ ë“±
        trigger: ["ì—”ì§„ ê²½ê³ ë“±", "ì²´í¬ ì—”ì§„"]
        response: "ì—”ì§„ ê²½ê³ ë“±ì´ ì¼œì¡Œë‹¤ë©´ ì°¨ëŸ‰ì„ ì •ì°¨í•˜ê³  ì •ë¹„ì†Œì— ì—°ë½í•˜ì„¸ìš”."
      - name: íƒ€ì´ì–´ í‘í¬
        trigger: ["íƒ€ì´ì–´", "í‘í¬", "ë°”ëŒ ë¹ ì§"]
        response: "ë¹„ìƒë“±ì„ ì¼œê³  ì•ˆì „í•œ ê³³ì— ì •ì°¨í•œ í›„, ìŠ¤í˜ì–´ íƒ€ì´ì–´ë¡œ êµì²´í•˜ê±°ë‚˜ ë³´í—˜ì‚¬ì— ì—°ë½í•˜ì„¸ìš”."

  en:
    steps:
      - name: Start Engine
        prompt: "Are you in the car? Please start the engine. Say 'engine started' when done."
      - name: Seatbelt
        prompt: "Have you fastened your seatbelt?"
      - name: Gear Shift
        prompt: "Change gear from 'P' to 'D'. Let me know when done."
      - name: Start Driving
        prompt: "You can start driving now. Drive slowly."
      - name: Enter Intersection
        prompt: "Check left and right before entering the intersection."
      - name: Lane Change
        prompt: "Do you need to change lanes? Make sure the indicator is on."
      - name: Parking
        prompt: "Have you arrived? Start parking. Let me know when done."
      - name: Turn Off Engine
        prompt: "Shift to 'P' and turn off the engine. Type 'drive complete' to finish."

    exceptions:
      - name: Engine Warning
        trigger: ["engine warning", "check engine"]
        response: "Stop the vehicle and contact a repair shop if the engine warning light is on."
      - name: Tire Puncture
        trigger: ["flat tire", "puncture", "air leak"]
        response: "Turn on hazard lights, stop safely, and replace the tire or call assistance."
```

---

## 2ï¸âƒ£ Python ì½”ë“œ: YAML ë¡œë”© + ë‹¤êµ­ì–´ LangGraph + ì˜ˆì™¸ì²˜ë¦¬

```python
import yaml
from langgraph.graph import StateGraph, END
from typing import TypedDict
import os

# ìƒíƒœ ì •ì˜
class AgentState(TypedDict):
    step_index: int
    intent: str
    language: str
    slots: dict
    prompt: str

# YAML ì‹œë‚˜ë¦¬ì˜¤ ë¡œë”©
def load_scenario(lang='ko'):
    with open("driving_scenario.yaml", "r", encoding="utf-8") as f:
        raw = yaml.safe_load(f)
    return raw[lang]

# ì˜ˆì™¸ íƒì§€
def detect_exception(user_input: str, exception_rules: list) -> str:
    for rule in exception_rules:
        for keyword in rule['trigger']:
            if keyword.lower() in user_input.lower():
                return rule['response']
    return ""

# LangGraph ì‹¤í–‰ ë…¸ë“œ
def step_executor(state: AgentState) -> AgentState:
    lang = state['language']
    scenario = load_scenario(lang)
    step_idx = state.get("step_index", 0)
    user_input = state["slots"].get("user_input", "")

    emergency = detect_exception(user_input, scenario['exceptions'])
    if emergency:
        return {**state, "prompt": f"[âš  ìœ„ê¸°ìƒí™©] {emergency}"}

    if step_idx >= len(scenario['steps']):
        return {**state, "prompt": "[âœ… ìš´ì „ ì™„ë£Œ]", "step_index": step_idx}

    prompt = scenario['steps'][step_idx]['prompt']
    return {**state, "prompt": prompt, "step_index": step_idx + 1}

# LangGraph ì„¤ì •
graph = StateGraph(AgentState)
graph.add_node("step_executor", step_executor)
graph.set_entry_point("step_executor")
graph.add_edge("step_executor", END)
app = graph.compile()
```

---

## 3ï¸âƒ£ FastAPI + Ollama í†µí•© ì„œë²„

### âœ… ì„œë²„ ì½”ë“œ (`main.py`)

```python
from fastapi import FastAPI, Request
from pydantic import BaseModel
from langgraph_runner import app as langgraph_app
import uvicorn

app = FastAPI()

class UserRequest(BaseModel):
    session_id: str
    user_input: str
    language: str = "ko"  # default to Korean

# ì„¸ì…˜ ìƒíƒœ ì €ì¥ (ì„ì‹œ ë©”ëª¨ë¦¬)
SESSIONS = {}

@app.post("/drive")
def handle_drive(req: UserRequest):
    session_id = req.session_id
    user_input = req.user_input
    language = req.language

    # ì´ˆê¸° ìƒíƒœ ì„¤ì •
    if session_id not in SESSIONS:
        SESSIONS[session_id] = {
            "intent": "ìš´ì „ì‹œë‚˜ë¦¬ì˜¤",
            "step_index": 0,
            "slots": {},
            "prompt": "",
            "language": language
        }

    state = SESSIONS[session_id]
    state["slots"]["user_input"] = user_input

    # LangGraph í˜¸ì¶œ
    result = langgraph_app.invoke(state)
    SESSIONS[session_id] = result  # ìƒíƒœ ì €ì¥
    return {"prompt": result["prompt"], "step": result["step_index"]}

if __name__ == "__main__":
    uvicorn.run("main:app", host="0.0.0.0", port=8000, reload=True)
```

---

## âœ… í…ŒìŠ¤íŠ¸ ë°©ë²•

```bash
# ì„œë²„ ì‹¤í–‰
python main.py
```

```bash
# API ìš”ì²­ ì˜ˆì‹œ (curl)
curl -X POST http://localhost:8000/drive \
     -H "Content-Type: application/json" \
     -d '{"session_id": "abc123", "user_input": "ì‹œë™ ì™„ë£Œ", "language": "ko"}'
```

---

## ğŸ§© ìš”ì•½: ì „ì²´ êµ¬ì„± íë¦„

```plaintext
[YAML ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜]
        â†“
[LangGraph FSM êµ¬ì„±]
        â†“
[FastAPI ì„œë²„í™” â†’ /drive API ì œê³µ]
        â†“
[ì‚¬ìš©ì ì…ë ¥ì— ë”°ë¼ ë‹¨ê³„ì  ì‘ë‹µ ìƒì„± + ìœ„ê¸°ìƒí™© ëŒ€ì‘]
```

---

ì´ì œ YAML ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ â†’ ë‹¤êµ­ì–´ LangGraph FSM â†’ FastAPI ì„œë²„ê¹Œì§€ ëª¨ë‘ í†µí•©í•œ êµ¬ì¡°ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ ë‹¨ê³„ë¡œëŠ” ë‹¤ìŒë„ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤:

* ğŸŒ í´ë¼ì´ì–¸íŠ¸ ì•± ì—°ê²° (React Native, Flutter ë“±)
* ğŸ’¾ Redis ì„¸ì…˜ ì €ì¥
* ğŸ“– ì‚¬ìš©ìë³„ ë¡œê·¸ ê¸°ë¡ ë° ë¶„ì„

ì›í•˜ì‹œë©´ ì „ì²´ ì½”ë“œë¥¼ GitHub repo í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•˜ê±°ë‚˜, Dockerë¡œ íŒ¨í‚¤ì§•í•´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´í›„ ì–´ë–¤ ë¶€ë¶„ë¶€í„° ë„ì™€ë“œë¦´ê¹Œìš”?

---

>>> android ì™€ iOS ì•±ìœ¼ë¡œ ì—°ê²°í• êº¼ì•¼
>>> ê·¸ë¦¬ê³  ìŒì„±ëª¨ë“œë¥¼ ì§€ì›í•´ì„œ ì…ë ¥ì€ í…ŒìŠ¤íŠ¸ ë¿ë§Œ ì•„ë‹ˆë¼, ìŒì„±ìœ¼ë¡œë„ ì…ë ¥ë°›ê²Œ í• êº¼ì•¼.
>>> ìŒì„±ëª¨ë“œëŠ” ìŒì„±ìœ¼ë¡œ ì…ë ¥ë°›ê³  ìŒì„±ìœ¼ë¡œ ë‹µë³€ì„ ì¶œë ¥

ì¢‹ìŠµë‹ˆë‹¤! ì•„ë˜ëŠ” ìš”ì²­í•˜ì‹  ì „ì²´ ì‹œìŠ¤í…œì„ GitHub Repository í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•œ êµ¬ì¡°ì…ë‹ˆë‹¤. ì´ êµ¬ì¡°ëŠ” ë‹¤ìŒì„ ëª¨ë‘ í¬í•¨í•©ë‹ˆë‹¤:

---

## ğŸ“ GitHub Repo êµ¬ì¡° (`driving-agent-ai`)

```
driving-agent-ai/
â”‚
â”œâ”€â”€ README.md                          ğŸ‘ˆ í”„ë¡œì íŠ¸ ì„¤ëª… ë° ì‚¬ìš©ë²•
â”œâ”€â”€ requirements.txt                  ğŸ‘ˆ Python íŒ¨í‚¤ì§€ ëª©ë¡
â”œâ”€â”€ Modelfile                         ğŸ‘ˆ Ollama ëª¨ë¸ ì •ì˜
â”œâ”€â”€ driving_scenario.yaml            ğŸ‘ˆ YAML ê¸°ë°˜ ë‹¤êµ­ì–´ ìš´ì „ ì‹œë‚˜ë¦¬ì˜¤
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                      ğŸ‘ˆ FastAPI ì„œë²„ ì§„ì…ì 
â”‚   â”œâ”€â”€ langgraph_runner.py         ğŸ‘ˆ LangGraph FSM + YAML ë¡œë”
â”‚   â””â”€â”€ utils.py                    ğŸ‘ˆ ì˜ˆì™¸ì²˜ë¦¬ ë“± ê³µìš© í•¨ìˆ˜
â”‚
â”œâ”€â”€ mobile/
â”‚   â”œâ”€â”€ android/                    ğŸ‘ˆ (ì¶”í›„ ì—°ê²°) Android í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ ios/                        ğŸ‘ˆ (ì¶”í›„ ì—°ê²°) iOS í´ë¼ì´ì–¸íŠ¸
â”‚
â”œâ”€â”€ voice/
â”‚   â”œâ”€â”€ stt_client.py               ğŸ‘ˆ ìŒì„± â†’ í…ìŠ¤íŠ¸ (STT) ì²˜ë¦¬
â”‚   â”œâ”€â”€ tts_client.py               ğŸ‘ˆ í…ìŠ¤íŠ¸ â†’ ìŒì„± (TTS) ì²˜ë¦¬
â”‚   â””â”€â”€ config.py                   ğŸ‘ˆ ìŒì„± API í‚¤ ê´€ë¦¬
```

---

## ğŸ”§ í•µì‹¬ íŒŒì¼ ìš”ì•½

### âœ… `driving_scenario.yaml`

ë‹¤êµ­ì–´ ìš´ì „ ì‹œë‚˜ë¦¬ì˜¤ ë° ì˜ˆì™¸ ëŒ€ì‘ ì •ì˜

### âœ… `langgraph_runner.py`

LangGraph FSM êµ¬ì„± + YAML ë¡œë”© + ì˜ˆì™¸ì²˜ë¦¬

### âœ… `main.py` (FastAPI API ì„œë²„)

* `/drive`: ì…ë ¥ë°›ì€ ë©”ì‹œì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ LangGraph ì‹¤í–‰
* ì„¸ì…˜ ê¸°ë°˜ ë‹¤ì¤‘í„´ ì²˜ë¦¬

### âœ… `stt_client.py` & `tts_client.py`

* STT: Google Cloud Speech-to-Text ë˜ëŠ” Whisper API ì‚¬ìš© ê°€ëŠ¥
* TTS: Google TTS, Naver CLOVA, ElevenLabs ë“± ì—°ë™ ê°€ëŠ¥
* ëª¨ë°”ì¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìŒì„± ëª¨ë“œì¼ ê²½ìš°, ì´ íŒŒì¼ë“¤ê³¼ í†µì‹ 

---

## ğŸ“± ëª¨ë°”ì¼ ì—°ë™ ë°©í–¥

> Androidì™€ iOS ëª¨ë‘ **REST API í˜¸ì¶œ + TTS/STT ëª¨ë“ˆ í†µí•©** ë°©ì‹ìœ¼ë¡œ êµ¬ì„±

### ğŸ”Œ í†µì‹  íë¦„ (ìŒì„± ëª¨ë“œ)

```plaintext
(ì‚¬ìš©ì ìŒì„± ì…ë ¥)
  â†“ (STT)
ìŒì„± í…ìŠ¤íŠ¸ ë³€í™˜ (STT)
  â†“
/drive API í˜¸ì¶œ (POST)
  â†“
LangGraph ì‘ë‹µ í”„ë¡¬í”„íŠ¸ ìˆ˜ì‹ 
  â†“
í…ìŠ¤íŠ¸ë¥¼ ìŒì„±ìœ¼ë¡œ ë³€í™˜ (TTS)
  â†“
ì•±ì—ì„œ ìŒì„± ì¶œë ¥
```

* STT & TTSëŠ” ì„œë²„ ë˜ëŠ” ë¡œì»¬ ì—°ë™ ê°€ëŠ¥
* í´ë¼ì´ì–¸íŠ¸ì—ì„œ `ìŒì„±ëª¨ë“œ` ì—¬ë¶€ë¥¼ ìš”ì²­ bodyì— í¬í•¨ì‹œì¼œë„ ë¨

---

## ğŸ“„ ì˜ˆì‹œ `README.md`

````markdown
# ğŸš˜ Driving Agent AI (LangGraph + Ollama + Voice + App)

ì´ í”„ë¡œì íŠ¸ëŠ” ìë™ì°¨ ìš´ì „ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë”°ë¼ ë‹¨ê³„ë³„ ì•ˆë‚´ ë° ìœ„ê¸° ìƒí™© ëŒ€ì‘ì´ ê°€ëŠ¥í•œ AI Agentì…ë‹ˆë‹¤.  
LangGraph + Ollama ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¶•ë˜ì—ˆìœ¼ë©°, Android/iOS ì•± ë° ìŒì„± ëª¨ë“œ(STT/TTS)ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

---

## ğŸ§© ê¸°ëŠ¥

- ì‹œë™ â†’ ìš´ì „ â†’ ì£¼ì°¨ê¹Œì§€ ë‹¨ê³„ì  ì•ˆë‚´
- íƒ€ì´ì–´ í‘í¬, ë¸Œë ˆì´í¬ ê³ ì¥ ë“±ì˜ ìœ„ê¸° ëŒ€ì‘
- YAML ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜
- ë‹¤êµ­ì–´ ì§€ì› (í•œêµ­ì–´, ì˜ì–´)
- FastAPI ì„œë²„í™”
- Android/iOS ì•± ì—°ë™
- ìŒì„± ì…ë ¥(STT), ìŒì„± ì¶œë ¥(TTS)

---

## ğŸƒ ì‹¤í–‰ ë°©ë²•

```bash
# Python ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# ì„œë²„ ì‹¤í–‰
python app/main.py
````

API í˜¸ì¶œ ì˜ˆì‹œ:

```bash
curl -X POST http://localhost:8000/drive \
     -H "Content-Type: application/json" \
     -d '{"session_id": "user1", "user_input": "ì‹œë™ ì™„ë£Œ", "language": "ko"}'
```

---

## ğŸ“± ëª¨ë°”ì¼ ì—°ë™

ëª¨ë°”ì¼ ì•±ì€ REST APIë¥¼ í†µí•´ ë‹¤ìŒì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

1. ìŒì„±ìœ¼ë¡œ ì§ˆë¬¸ â†’ STT â†’ í…ìŠ¤íŠ¸
2. í…ìŠ¤íŠ¸ë¡œ API í˜¸ì¶œ â†’ LangGraph ì‘ë‹µ
3. ì‘ë‹µì„ TTSë¡œ ë³€í™˜ â†’ ìŒì„± ì¶œë ¥

---

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

* `app/` - ì„œë²„ ì½”ë“œ (LangGraph + FastAPI)
* `voice/` - STT/TTS í´ë¼ì´ì–¸íŠ¸ ëª¨ë“ˆ
* `mobile/` - Android/iOS ì•± ìƒ˜í”Œ ì—°ê²° ì§€ì 
* `driving_scenario.yaml` - ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜

```

---

## ğŸ§­ ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

1. `GitHub repo` í˜•íƒœë¡œ ì‹¤ì œ íŒŒì¼ ì••ì¶•í•˜ì—¬ ì „ë‹¬ ê°€ëŠ¥ (ì›í•  ê²½ìš° zip ìƒì„±)
2. ëª¨ë°”ì¼ í´ë¼ì´ì–¸íŠ¸ ì˜ˆì œ ì½”ë“œ ì¶”ê°€ ê°€ëŠ¥ (SwiftUI, Jetpack Compose)
3. TTS/STT ì„¤ì •ì„ ìœ„í•œ ì˜ˆì‹œ API (Google Cloud, Naver CLOVA ë“±) ì¶”ê°€ ê°€ëŠ¥
4. Dockerfileë¡œ ì „ì²´ íŒ¨í‚¤ì§• ê°€ëŠ¥

---

ğŸ‘‰ ì›í•˜ì‹œëŠ” ë°©ì‹ìœ¼ë¡œ zip íŒŒì¼ì„ ìƒì„±í•´ë“œë¦´ê¹Œìš”?  
ë˜ëŠ” GitHubì— ì˜¬ë¦´ ìˆ˜ ìˆëŠ” `.zip` í˜•íƒœë¡œ ì½”ë“œ ë¬¶ì–´ì„œ ë“œë¦´ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.  
ê·¸ë¦¬ê³  Android/iOS ì•± ì˜ˆì œ ì¤‘ ì–´ë–¤ í”Œë«í¼ë¶€í„° ì›í•˜ì‹œë‚˜ìš”?
```

---

>>> ê·¸ëŸ°ë° ë‹¤êµ­ì–´ ì§€ì›ì´ ëª¨ë°”ì¼ì—ì„œ ì§€ì›í•˜ëŠ” ëª¨ë“  ì–¸ì–´ë¥¼ ì§€ì›í•˜ê³  ì‹¶ì–´. ê·¼ë° ìœ„ ë°©ë²•ìœ¼ë¡œëŠ” ê° êµ­ê°€ë³„ë¡œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì •ë¦¬í•´ì•¼í•˜ëŠ”ë°, ì´ê±°ë¥¼ ì¢€ ë” ìŠ¤ë§ˆíŠ¸í•˜ê²Œ í•˜ëŠ” ë°©ë²•ì—†ì–´?


í›Œë¥­í•œ ì§ˆë¬¸ì´ì—ìš”. ë§ì”€í•˜ì‹  ëŒ€ë¡œ **ì–¸ì–´ë³„ë¡œ YAMLì— ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì¼ì¼ì´ ì •ì˜**í•˜ëŠ” ê²ƒì€:

* êµ­ê°€ ìˆ˜ê°€ ë§ì•„ì§ˆìˆ˜ë¡ **ìœ ì§€ë³´ìˆ˜ ë¹„ìš© í­ë°œ**
* ë™ê¸°í™” ëˆ„ë½, ë²ˆì—­ ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥ì„± ì¦ê°€
* ê°œë°œì/ê¸°íšì ì…ì¥ì—ì„œ **í™•ì¥ì„± ë§¤ìš° ë‚®ìŒ**

---

## âœ… ëª©í‘œ

> "í•˜ë‚˜ì˜ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, **ëª¨ë“  ì–¸ì–´ì— ìë™ ë²ˆì—­ëœ í”„ë¡¬í”„íŠ¸**ë¥¼ ì‹¤ì‹œê°„ ìƒì„±"

---

## ğŸ’¡ í•´ê²° ë°©ë²•: **ë™ì  ë²ˆì—­ ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±**

### í•µì‹¬ ì•„ì´ë””ì–´

* YAML ì‹œë‚˜ë¦¬ì˜¤ íŒŒì¼ì€ \*\*ê¸°ë³¸ ì–¸ì–´(ì˜ˆ: ì˜ì–´)\*\*ë§Œ ì‘ì„±
* ì‚¬ìš©ìê°€ ìš”ì²­í•œ ì–¸ì–´ë¡œ LangGraph ì‹¤í–‰ ì‹œ, í”„ë¡¬í”„íŠ¸ë¥¼ **ì‹¤ì‹œê°„ ë²ˆì—­**
* ë²ˆì—­ì€ **LLM** ë˜ëŠ” \*\*API(Google/Naver/DeepL ë“±)\*\*ë¥¼ í†µí•´ ìˆ˜í–‰

---

## ğŸ“¦ êµ¬í˜„ ë°©ì‹

### ğŸ”¹ 1. ê¸°ë³¸ ì‹œë‚˜ë¦¬ì˜¤ YAML êµ¬ì¡° (1ê°œ ì–¸ì–´ë§Œ ìœ ì§€)

```yaml
scenario:
  steps:
    - name: Start Engine
      prompt: "Are you in the car? Please start the engine. Say 'engine started' when done."
    - name: Gear Shift
      prompt: "Change gear from 'P' to 'D'. Let me know when done."
  exceptions:
    - name: Engine Warning
      trigger: ["engine warning", "check engine"]
      response: "If the engine warning light is on, please stop and call a repair shop."
```

---

### ğŸ”¹ 2. ë‹¤êµ­ì–´ ë²ˆì—­ í•¨ìˆ˜ (ì‹¤ì‹œê°„ ë³€í™˜)

```python
from typing import List
import ollama

def translate_text(text: str, target_lang: str) -> str:
    prompt = f"Translate the following into {target_lang}:\n\n{text}"
    response = ollama.chat(
        model="llama3-local",  # or use openai, etc.
        messages=[{"role": "user", "content": prompt}]
    )
    return response['message']['content']
```

---

### ğŸ”¹ 3. ì‹œë‚˜ë¦¬ì˜¤ ì „ì²´ ë²ˆì—­ ìºì‹± ì²˜ë¦¬

```python
def translate_scenario(base_scenario: dict, target_lang: str) -> dict:
    translated = {"steps": [], "exceptions": []}

    for step in base_scenario["steps"]:
        translated_prompt = translate_text(step["prompt"], target_lang)
        translated["steps"].append({"name": step["name"], "prompt": translated_prompt})

    for ex in base_scenario["exceptions"]:
        translated_resp = translate_text(ex["response"], target_lang)
        translated["exceptions"].append({
            "name": ex["name"],
            "trigger": ex["trigger"],
            "response": translated_resp
        })

    return translated
```

---

## ğŸ§  ì´ ë°©ì‹ì˜ ì¥ì 

| í•­ëª©     | ê¸°ì¡´ ë°©ì‹ (ì–¸ì–´ë³„ YAML) | ë™ì  ë²ˆì—­ ë°©ì‹          |
| ------ | ---------------- | ----------------- |
| ìœ ì§€ë³´ìˆ˜   | ì–¸ì–´ ì¶”ê°€ ì‹œ íŒŒì¼ ì¦ê°€    | YAML 1ê°œë¡œ í•´ê²°       |
| ë²ˆì—­ í’ˆì§ˆ  | ìˆ˜ë™ ì˜¤ë¥˜ ê°€ëŠ¥ì„± ìˆìŒ     | LLM ìë™ ë²ˆì—­         |
| ì½”ë“œ í™•ì¥ì„± | ë‚®ìŒ               | ë§¤ìš° ë†’ìŒ             |
| ì†ë„     | ë¹ ë¦„               | ì•½ê°„ ëŠë¦¬ë‚˜ ìºì‹±ìœ¼ë¡œ í•´ê²° ê°€ëŠ¥ |

---

## ğŸ’¡ ì„±ëŠ¥ ìµœì í™” íŒ

1. **LangGraph ì‹¤í–‰ ì „ì— ë²ˆì—­ ìºì‹±**

   * ì‚¬ìš©ì ì–¸ì–´ ìš”ì²­ì´ ì²˜ìŒì¼ ë•Œë§Œ ë²ˆì—­ ì‹¤í–‰
   * ì´í›„ Redis / ë©”ëª¨ë¦¬ / íŒŒì¼ë¡œ ìºì‹±

2. **ê¸´ í”„ë¡¬í”„íŠ¸ëŠ” chunking ë²ˆì—­**

   * í•œ ë²ˆì— ë„ˆë¬´ ë§ì€ í…ìŠ¤íŠ¸ë¥¼ ë²ˆì—­ ìš”ì²­í•˜ì§€ ì•Šë„ë¡ ë‚˜ëˆ ì„œ ì²˜ë¦¬

3. **ì˜¤í”„ë¼ì¸ ê¸°ê¸°ìš© ë²ˆì—­**

   * ë¯¸ë¦¬ ë²ˆì—­ëœ json íŒŒì¼ì„ ì¤€ë¹„í•´ë†“ê³  ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ fall-back

---

## âœ¨ ì¶”ê°€ í™•ì¥

| ê¸°ëŠ¥                     | ì„¤ëª…                                     |
| ---------------------- | -------------------------------------- |
| ğŸŒ LangChain Router í†µí•© | ì‚¬ìš© ì–¸ì–´ ê°ì§€ í›„ ìë™ ë¶„ê¸° ì²˜ë¦¬                    |
| ğŸ™ï¸ ìŒì„± ì–¸ì–´ ìë™ ê°ì§€        | ì‚¬ìš©ì ìŒì„±ìœ¼ë¡œ ì–¸ì–´ ìë™ ì„¤ì •                      |
| ğŸ“ ë‹¤êµ­ì–´ ì‹œë‚˜ë¦¬ì˜¤ export     | íŠ¹ì • ì–¸ì–´ ìš”ì²­ ì‹œ YAML ìë™ ìƒì„± í›„ ì €ì¥ (ì˜ˆ: ë²ˆì—­ ê´€ë¦¬ìš©) |

---

## ğŸ“Œ ìš”ì•½

| ë¬¸ì œ                 | í•´ê²°ì±…                    |
| ------------------ | ---------------------- |
| ì–¸ì–´ë³„ YAML íŒŒì¼ ë„ˆë¬´ ë§ì•„ì§ | ğŸ‘‰ í•˜ë‚˜ì˜ ì˜ì–´ YAMLë§Œ ìœ ì§€     |
| ë‹¤êµ­ì–´ ë²ˆì—­ ê´€ë¦¬ ì–´ë ¤ì›€      | ğŸ‘‰ ì‹¤ì‹œê°„ ë²ˆì—­ (LLM or API) |
| ë²ˆì—­ ë¹„ìš© ê±±ì •           | ğŸ‘‰ ìºì‹± í™œìš©ìœ¼ë¡œ 1íšŒë§Œ ë²ˆì—­      |

---

ì›í•˜ì‹œë©´ ì´ ë™ì  ë‹¤êµ­ì–´ ë²ˆì—­ ê¸°ëŠ¥ì„ í¬í•¨í•œ ì½”ë“œë¥¼ `langgraph_runner.py`ì— í†µí•©í•´ë“œë¦´ ìˆ˜ ìˆì–´ìš”.
ë˜ëŠ” ì‹¤ì‹œê°„ + ìºì‹œ êµ¬ì¡°ë¡œ ë°”ë¡œ ì ìš© ê°€ëŠ¥í•œ êµ¬ì¡°ë¡œ zip ë‹¤ì‹œ ë§Œë“¤ì–´ë“œë¦´ ìˆ˜ë„ ìˆì–´ìš”.

ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”? ğŸ˜Š

---

>>> ì¢‹ì•„ ì‹œë‚˜ë¦¬ì˜¤ì— ë”°ë¥¸ ë‹¤ì–‘í•œ ë²ˆì—­ì€ ë˜ëŠ”ë°, ì´ì œ êµ­ê°€ì— ë”°ë¼ ì‹œë‚˜ë¦¬ì˜¤ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìë‚˜. ì˜ˆë¥¼ë“¤ì–´ ìš´ì „ì— ëŒ€í•œ ê·œì œë“± êµ­ê°€ë§ˆë‹¤ ë‹¤ë¥´ë‹¨ë§ì•¼. ì´ëŸ°ê²ƒë“¤ì€ ì–´ë–»ê²Œ ì²˜ë¦¬í•´ì•¼í•˜ì§€?

ì•„ì£¼ ì¢‹ì€ ì§ˆë¬¸ì…ë‹ˆë‹¤. ë§ì”€í•˜ì‹  ë¶€ë¶„ì€ \*\*â€œì–¸ì–´â€ì˜ ë¬¸ì œë¥¼ ë„˜ì–´ì„œ â€œêµ­ê°€/ì§€ì—­ë³„ ì‹œë‚˜ë¦¬ì˜¤ì˜ ì°¨ì´â€\*\*ë¼ëŠ” ì¤‘ìš”í•œ ë¬¸ì œë¡œ, ë‹¨ìˆœ ë²ˆì—­ìœ¼ë¡œëŠ” í•´ê²°í•  ìˆ˜ ì—†ëŠ” êµ¬ì¡°ì  ì°¨ì´ë¥¼ ë‹¤ë£¨ì–´ì•¼ í•©ë‹ˆë‹¤.

---

## âœ… ë¬¸ì œ ì •ì˜

| êµ¬ë¶„              | ì˜ˆì‹œ                                                        |
| --------------- | --------------------------------------------------------- |
| **ì–¸ì–´ ì°¨ì´**       | ì˜ì–´ â†” í•œêµ­ì–´ ë²ˆì—­                                               |
| **êµ­ê°€ë³„ ì‹œë‚˜ë¦¬ì˜¤ ì°¨ì´** | í•œêµ­ì€ ìœ í„´ ê¸ˆì§€ êµ¬ê°„ì´ ë§ê³ , ì¼ë³¸ì€ ì¢Œì¸¡í†µí–‰, ë¯¸êµ­ì€ ìš°íšŒì „ ììœ  ë“± **ê·œì¹™/ì ˆì°¨ ìì²´ê°€ ë‹¤ë¦„** |

---

## ğŸ¯ ëª©í‘œ:

> **â€œêµ­ê°€(ë˜ëŠ” ì§€ì—­)â€ë³„ë¡œ ì‹œë‚˜ë¦¬ì˜¤ ë¡œì§ ìì²´ë¥¼ ë‹¤ë¥´ê²Œ êµ¬ì„±í•˜ë˜, ì¤‘ë³µì„ ìµœì†Œí™”í•˜ê³  ìœ ì§€ë³´ìˆ˜ì„±ì„ ë†’ì´ëŠ” êµ¬ì¡° ë§Œë“¤ê¸°**

---

## ğŸ’¡ í•´ê²° ì „ëµ: "ì‹œë‚˜ë¦¬ì˜¤ ìƒì† + ë²ˆì—­ ë¶„ë¦¬ + ê·œì¹™ í™•ì¥"

### ğŸ”· 1. ì‹œë‚˜ë¦¬ì˜¤ë¥¼ \*\*"ì§€ì—­ë³„ ë¶„ê¸°" + "ì–¸ì–´ë³„ ë²ˆì—­"\*\*ìœ¼ë¡œ ë¶„ë¦¬

* "ì§€ì—­" = **ë¡œì§ ë¶„ê¸° ê¸°ì¤€**
* "ì–¸ì–´" = **UI í…ìŠ¤íŠ¸ ì¶œë ¥ìš©**

---

## âœ… êµ¬ì¡° ì œì•ˆ

### ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
scenarios/
â”œâ”€â”€ global.yaml                 # ì „ ì„¸ê³„ ê³µí†µ ì‹œë‚˜ë¦¬ì˜¤ (ê¸°ë³¸ êµ¬ì¡°)
â”œâ”€â”€ korea.yaml                 # í•œêµ­ íŠ¹í™” ì‹œë‚˜ë¦¬ì˜¤ (ìƒì†/ë®ì–´ì“°ê¸° ê°€ëŠ¥)
â”œâ”€â”€ usa.yaml                   # ë¯¸êµ­ íŠ¹í™” ì‹œë‚˜ë¦¬ì˜¤
â”œâ”€â”€ japan.yaml                 # ì¼ë³¸ íŠ¹í™” ì‹œë‚˜ë¦¬ì˜¤
â””â”€â”€ ...
```

### ğŸŒ ì–¸ì–´ ë²ˆì—­ JSON

```
translations/
â”œâ”€â”€ ko.json
â”œâ”€â”€ en.json
â”œâ”€â”€ ja.json
â””â”€â”€ ...
```

---

## ğŸ› ï¸ 2. êµ­ê°€ë³„ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì¡° ì˜ˆì‹œ (`korea.yaml`)

```yaml
extends: global
scenario:
  steps:
    - name: ìœ í„´ê·œì¹™
      prompt_key: uturn_rule_korea
    - name: ê³ ì†ë„ë¡œì§„ì…
      prompt_key: highway_entry_korea
  overrides:
    - name: ì°¨ì„ ë³€ê²½
      prompt_key: korean_lane_change
```

## ğŸŒ ë²ˆì—­ JSON (`ko.json`)

```json
{
  "uturn_rule_korea": "í•œêµ­ì—ì„œëŠ” ëŒ€ë¶€ë¶„ì˜ ë„ë¡œì—ì„œ ìœ í„´ì´ ì œí•œë©ë‹ˆë‹¤. ìœ í„´ ê°€ëŠ¥ êµ¬ê°„ì„ í™•ì¸í•˜ì„¸ìš”.",
  "highway_entry_korea": "ê³ ì†ë„ë¡œ ì§„ì… ì „, í•˜ì´íŒ¨ìŠ¤ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”.",
  "korean_lane_change": "ì°¨ì„  ë³€ê²½ ì‹œ ë°˜ë“œì‹œ ë°©í–¥ì§€ì‹œë“±ì„ 3ì´ˆ ì´ìƒ ì¼œì„¸ìš”."
}
```

---

## ğŸ§  ì‹¤í–‰ íë¦„

```plaintext
[ì‚¬ìš©ì ìš”ì²­]
   â†“
[êµ­ê°€ ì½”ë“œ â†’ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ]
   â†“
[ì–¸ì–´ ì½”ë“œ â†’ prompt_key ë¥¼ ë²ˆì—­]
   â†“
[LangGraph ì‹¤í–‰]
```

### ì˜ˆì‹œ

* ì‚¬ìš©ì: `country="KR", language="en"`
  â†’ `korea.yaml` + `en.json` ì¡°í•©ìœ¼ë¡œ ì‹¤í–‰

* ì‚¬ìš©ì: `country="JP", language="ja"`
  â†’ `japan.yaml` + `ja.json`

---

## ğŸ’¡ ì¥ì  ìš”ì•½

| í•­ëª©               | ì„¤ëª…                     |
| ---------------- | ---------------------- |
| ì‹œë‚˜ë¦¬ì˜¤/ë¡œì§ê³¼ í…ìŠ¤íŠ¸ ë¶„ë¦¬  | ìœ ì§€ë³´ìˆ˜ ìš©ì´                |
| êµ­ê°€ë³„ ê·œì œ, ì ˆì°¨ ë°˜ì˜ ê°€ëŠ¥ | ì¼ë³¸ì€ ì¢Œì¸¡í†µí–‰, ë¯¸êµ­ì€ ìš°íšŒì „ ììœ  ë“± |
| ì–¸ì–´ëŠ” ë²ˆì—­ í‚¤ë¡œ ì²˜ë¦¬     | ëª¨ë“  ì–¸ì–´ ìë™ ì§€ì›            |
| ê³µí†µ ì‹œë‚˜ë¦¬ì˜¤ ìƒì†       | ë°˜ë³µ ì œê±°, ì˜¤ë²„ë¼ì´ë“œ ê°€ëŠ¥        |

---

## ğŸ§± ê¸°ìˆ  êµ¬í˜„ ìš”ì•½

* YAML íŒŒì„œê°€ `extends: global` ì„ ë§Œë‚˜ë©´ ë¶€ëª¨ ì‹œë‚˜ë¦¬ì˜¤ ë¶ˆëŸ¬ì™€ ë³‘í•©
* `prompt_key`ë¡œ í…ìŠ¤íŠ¸ë¥¼ ê´€ë¦¬í•˜ê³  ì–¸ì–´ì— ë”°ë¼ ë²ˆì—­ íŒŒì¼ì—ì„œ ë§¤í•‘
* LangGraphì˜ promptëŠ” `translate(prompt_key, lang)`ì„ í†µí•´ ì ìš©

---

## ğŸ“¦ ì¶”ê°€ ì˜µì…˜

* ì§€ì—­ë³„ TTS/STT ì—”ì§„ ìë™ ì„ íƒ
* ì§€ë„ API ì—°ë™ ì‹œ í˜„ì§€ ë„ë¡œ êµí†µ ë²•ê·œ ìë™ ë°˜ì˜
* fallback: êµ­ê°€ê°€ ì—†ìœ¼ë©´ `global.yaml` ì‚¬ìš©

---

## âœ… ê²°ë¡ 

| í•´ê²° ë°©ë²•                       | í•µì‹¬                  |
| --------------------------- | ------------------- |
| ë¡œì§ì€ â€œêµ­ê°€(country)â€ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬   | â†’ YAML ì‹œë‚˜ë¦¬ì˜¤ ë¶„ê¸°      |
| í…ìŠ¤íŠ¸ëŠ” â€œì–¸ì–´(language)â€ ê¸°ì¤€ìœ¼ë¡œ ë²ˆì—­ | â†’ ë‹¤êµ­ì–´ JSON          |
| ìƒì† êµ¬ì¡°ë¡œ ê³µí†µ ìœ ì§€                | â†’ `extends: global` |

---

## ğŸ› ï¸ ë„ì™€ë“œë¦´ ìˆ˜ ìˆëŠ” ì‘ì—…

1. `global.yaml`, `korea.yaml`, `usa.yaml` ì˜ˆì‹œ ì‘ì„±
2. `ko.json`, `en.json` ë²ˆì—­ í‚¤/ê°’ êµ¬ì„±
3. ë³‘í•© ë¡œë” Python ì½”ë“œ ì‘ì„±
4. zip ë¦¬íŒ©í† ë§ ë° êµ¬ì¡° ë°˜ì˜

ì§„í–‰í•´ë“œë¦´ê¹Œìš”? ì–´ëŠ êµ­ê°€ë¶€í„° ì‹œì‘í• ê¹Œìš”? ğŸ‡°ğŸ‡· ğŸ‡ºğŸ‡¸ ğŸ‡¯ğŸ‡µ ğŸ‡©ğŸ‡ª ğŸ‡«ğŸ‡· ğŸ‡¹ğŸ‡­ ğŸ‡§ğŸ‡· ğŸ‡ªğŸ‡¸ â€¦

---

>>> ìƒì†ê³¼ ë®ì–´ì“°ê¸°ì— ëŒ€í•œ ì˜ˆì œë¥¼ ì¢€ ë” ìì„¸í•˜ê²Œ ë³´ì—¬ì¤˜. êµ­ê°€ì™¸ì—ë„ íŠ¹ì • ê²½ìš°ì— ì‹œë‚˜ë¦¬ì˜¤ì— ëŒ€í•œ ì°¨ì´ê°€ ìˆëŠ” ë¶€ë¶„ì€ ì–´ë–»ê²Œ ì²˜ë¦¬í•´?

í›Œë¥­í•©ë‹ˆë‹¤.
ì´ì œ ì´ ì‹œìŠ¤í…œì„ **ë” ìœ ì—°í•˜ê²Œ í™•ì¥**í•˜ê¸° ìœ„í•´ì„œ:

* **ìƒì†/ë®ì–´ì“°ê¸° êµ¬ì¡°ë¥¼ ëª…í™•íˆ ì´í•´í•˜ê³ **,
* **êµ­ê°€ ì™¸ ì¡°ê±´ë“¤ (ì˜ˆ: ì´ˆë³´ ìš´ì „ì, ì „ê¸°ì°¨, ê³ ì†ë„ë¡œ ì£¼í–‰ ë“±)** ë„ ì‹œë‚˜ë¦¬ì˜¤ì— ë°˜ì˜í•  ìˆ˜ ìˆëŠ” **êµ¬ì¡°ì  í™•ì¥ì„±**ì´ í•„ìš”í•©ë‹ˆë‹¤.

---

## âœ… 1. ê¸°ë³¸ ì‹œë‚˜ë¦¬ì˜¤ ìƒì†/ë®ì–´ì“°ê¸° ì˜ˆì œ

### ğŸ“ ì˜ˆì‹œ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
scenarios/
â”œâ”€â”€ global.yaml
â”œâ”€â”€ korea.yaml         ğŸ‘ˆ í•œêµ­ íŠ¹í™” ì‹œë‚˜ë¦¬ì˜¤ (ìƒì† + ì¼ë¶€ ë‹¨ê³„ ë®ì–´ì“°ê¸°)
â”œâ”€â”€ beginner.yaml      ğŸ‘ˆ ì´ˆë³´ ìš´ì „ì ì‹œë‚˜ë¦¬ì˜¤ (ì¶”ê°€ ë‹¨ê³„ ì‚½ì…)
```

---

### ğŸ“„ `global.yaml` â€“ ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ì˜ ê¸°ë³¸ ë² ì´ìŠ¤

```yaml
scenario:
  steps:
    - name: start_engine
      prompt_key: start_engine
    - name: seatbelt
      prompt_key: seatbelt
    - name: gear_shift
      prompt_key: gear_shift
    - name: drive
      prompt_key: start_driving
    - name: parking
      prompt_key: parking
  exceptions:
    - name: engine_warning
      trigger: ["check engine", "engine light"]
      response_key: engine_warning
```

---

### ğŸ“„ `korea.yaml` â€“ í•œêµ­ ë„ë¡œê·œì¹™ ë°˜ì˜ ì˜ˆì œ (ë®ì–´ì“°ê¸° + ì¶”ê°€)

```yaml
extends: global
scenario:
  overrides:
    - name: gear_shift
      prompt_key: gear_shift_korea  # 'P'ì—ì„œ 'D' ì „í™˜ ì „ ì‚¬ì´ë“œ ë¸Œë ˆì´í¬ í•´ì œ ê°•ì¡°
  insert_after:
    - name: seatbelt
      new_step:
        name: hpass_check
        prompt_key: korea_hpass
```

### ğŸ“„ `ko.json` ë²ˆì—­

```json
{
  "start_engine": "ì‹œë™ì„ ê±¸ì–´ì£¼ì„¸ìš”.",
  "seatbelt": "ì•ˆì „ë²¨íŠ¸ë¥¼ ì°©ìš©í•˜ì…¨ë‚˜ìš”?",
  "gear_shift": "ê¸°ì–´ë¥¼ Pì—ì„œ Dë¡œ ë°”ê¿”ì£¼ì„¸ìš”.",
  "gear_shift_korea": "í•œêµ­ì—ì„œëŠ” ì‚¬ì´ë“œ ë¸Œë ˆì´í¬ë¥¼ ë¨¼ì € í•´ì œí•œ í›„, Pì—ì„œ Dë¡œ ë°”ê¿”ì£¼ì„¸ìš”.",
  "korea_hpass": "í•˜ì´íŒ¨ìŠ¤ ë‹¨ë§ê¸°ê°€ ì¥ì°©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.",
  "start_driving": "ì¶œë°œí•˜ì„¸ìš”.",
  "parking": "ë„ì°©í•˜ì…¨ë‚˜ìš”? ì£¼ì°¨ë¥¼ ì§„í–‰í•˜ì„¸ìš”.",
  "engine_warning": "ì—”ì§„ ê²½ê³ ë“±ì´ ì¼œì¡ŒìŠµë‹ˆë‹¤. ì •ë¹„ì†Œì— ë¬¸ì˜í•˜ì„¸ìš”."
}
```

---

## ğŸ§  ë³‘í•© ê²°ê³¼ (ìë™ ìƒì„±ëœ ê²°ê³¼ êµ¬ì¡°)

```yaml
scenario:
  steps:
    - name: start_engine
    - name: seatbelt
    - name: hpass_check              # ì¶”ê°€ë¨
    - name: gear_shift              # ë®ì–´ì“°ê¸°
    - name: drive
    - name: parking
```

---

## âœ… 2. â€œêµ­ê°€ ì™¸ ì¡°ê±´â€ì— ë”°ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ ë¶„ê¸° ë°©ë²•

êµ­ê°€ ì™¸ì—ë„ ë‹¤ìŒê³¼ ê°™ì€ ì¡°ê±´ìœ¼ë¡œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ **ìƒí™©ì— ë§ê²Œ ì¡°í•©**í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

| ì¡°ê±´ ìœ í˜•  | ì˜ˆì‹œ              |
| ------ | --------------- |
| ìš´ì „ì ìƒíƒœ | ì´ˆë³´ì, ê³ ë ¹ì, ìˆ™ë ¨ì   |
| ì°¨ëŸ‰ ì¢…ë¥˜  | ì „ê¸°ì°¨, ìˆ˜ë™ì°¨, ììœ¨ì£¼í–‰ì°¨ |
| ë„ë¡œ í™˜ê²½  | ê³ ì†ë„ë¡œ, ì‚°ê¸¸, ë„ì‹¬    |
| ë‚ ì”¨ ìƒí™©  | ëˆˆ, ë¹„, ì•ˆê°œ ë“±      |
| íƒ‘ìŠ¹ì    | ì–´ë¦°ì´, ë°˜ë ¤ë™ë¬¼ ë™ìŠ¹    |

---

## ğŸ”§ í•´ê²° ì „ëµ: **ë©€í‹° ê³„ì¸µ ì¡°ê±´ ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ ì¡°í•©**

### ë°©ë²• 1: ë‹¤ì¤‘ `extends` ì§€ì›

```yaml
extends:
  - global
  - beginner
  - korea
```

â†’ ì—¬ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ ë² ì´ìŠ¤ë¥¼ ë³‘í•©í•˜ê³ , **ìˆœì„œëŒ€ë¡œ override/insert** ì ìš©

---

### ë°©ë²• 2: ì¡°ê±´ì„ metaë¡œ í‘œí˜„

```yaml
meta:
  country: KR
  user_type: beginner
  car_type: ev
  weather: rain
```

â†’ ì„œë²„ì—ì„œ metaì— ë§ëŠ” ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒ/ì¡°í•©

---

### ğŸ“„ `beginner.yaml` â€“ ì´ˆë³´ ìš´ì „ì ì¶”ê°€ ì•ˆë‚´

```yaml
extends: global
scenario:
  insert_before:
    - name: gear_shift
      new_step:
        name: mirror_check
        prompt_key: beginner_mirror_check
  overrides:
    - name: start_driving
      prompt_key: beginner_start_driving
```

```json
{
  "beginner_mirror_check": "ì‚¬ì´ë“œë¯¸ëŸ¬ì™€ ë°±ë¯¸ëŸ¬ë¥¼ ì •í™•íˆ ì¡°ì •í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.",
  "beginner_start_driving": "ì²œì²œíˆ, ë¶€ë“œëŸ½ê²Œ ì¶œë°œí•˜ì„¸ìš”. ê¸‰ì¶œë°œì€ ìœ„í—˜í•©ë‹ˆë‹¤."
}
```

---

## âœ… êµ¬í˜„ ì‹œ ê³ ë ¤ ì‚¬í•­

| í•­ëª©         | ì„¤ëª…                                  |
| ---------- | ----------------------------------- |
| ì‹œë‚˜ë¦¬ì˜¤ ë³‘í•© ìˆœì„œ | `extends`ì— ì„ ì–¸ëœ ìˆœì„œëŒ€ë¡œ ì ìš© (ë’¤ì˜ í•­ëª©ì´ ë®ì–´ì”€) |
| step ê¸°ì¤€    | `name` í•„ë“œë¡œ ê³ ìœ  ID ê´€ë¦¬                 |
| insert ìœ„ì¹˜  | `insert_before`, `insert_after` ì‚¬ìš©  |
| prompt ë¶„ë¦¬  | `prompt_key`ë¡œ ë²ˆì—­ ì‹œìŠ¤í…œê³¼ ì—°ê²°ë¨           |

---

## âœ¨ í™•ì¥ ì˜ˆì‹œ

| ì‹œë‚˜ë¦¬ì˜¤ ì¡°í•©                             | ì ìš© ì˜ˆ            |
| ----------------------------------- | --------------- |
| `global` + `korea`                  | í•œêµ­ì¸ ìš´ì „ì         |
| `global` + `usa` + `beginner`       | ë¯¸êµ­ ì´ˆë³´ì          |
| `global` + `korea` + `ev` + `rainy` | í•œêµ­, ì „ê¸°ì°¨, ë¹„ ì˜¤ëŠ” ë‚  |

---

## ğŸ“Œ ê²°ë¡ : ì‹œë‚˜ë¦¬ì˜¤ í™•ì¥ ì „ëµ ìš”ì•½

| í•­ëª©            | ì „ëµ                                       |
| ------------- | ---------------------------------------- |
| êµ­ê°€ë³„ ê·œì¹™        | ì‹œë‚˜ë¦¬ì˜¤ `extends` ë° `overrides`ë¡œ êµ¬í˜„         |
| ì‚¬ìš©ì ìœ í˜•ë³„ ì¡°ê±´    | `beginner.yaml`, `ev.yaml` ë“± ì¡°í•©í˜• ì‹œë‚˜ë¦¬ì˜¤ ë¶„ë¦¬ |
| ì–¸ì–´ëŠ” ë²ˆì—­ë§Œ ë”°ë¡œ ê´€ë¦¬ | prompt\_key ê¸°ë°˜ ë‹¤êµ­ì–´ ëŒ€ì‘                    |
| ë‹¤ì¤‘ ì¡°ê±´ ì¡°í•©      | `meta` í•„ë“œ ê¸°ë°˜ ì¡°í•© + ë³‘í•©ë¡œì§ ìë™í™”               |

---

## ğŸ› ï¸ ë„ì™€ë“œë¦´ ìˆ˜ ìˆëŠ” ê²ƒ

* ì‹œë‚˜ë¦¬ì˜¤ ë³‘í•© ì—”ì§„ (`load_and_merge_yaml()`) ì‘ì„±
* `insert_before`, `insert_after`, `override` ë¡œì§ êµ¬í˜„
* ì¡°ê±´ ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ ì¡°í•© ì²˜ë¦¬ (`meta` ê¸°ë°˜)
* ë‹¤êµ­ì–´ ë²ˆì—­ ìë™ ë§¤í•‘ ì²˜ë¦¬

í•„ìš”í•˜ì‹œë©´ ì‹¤ì œ ë³‘í•© ì½”ë“œ ë° í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ zipìœ¼ë¡œ ë§Œë“¤ì–´ ë“œë¦´ê²Œìš”.
ì›í•˜ì‹œëŠ” ì¡°ê±´ ì¡°í•©ìœ¼ë¡œ ì˜ˆì œ ë§Œë“¤ì–´ë³¼ê¹Œìš”?

---

>>> ì§€ê¸ˆê¹Œì§€ì˜ ë‚´ìš©ìœ¼ë¡œ ì‹¤ì œ ì „ì²´ ë³‘í•© ì½”ë“œë¥¼ ë³´ì—¬ì¤˜

ì•„ë˜ëŠ” `global.yaml`, `korea.yaml`, `beginner.yaml` ì„¸ ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë³‘í•©í•œ ê²°ê³¼ì…ë‹ˆë‹¤.

* \*\*`gear_shift`\*\*ëŠ” í•œêµ­ìš©ìœ¼ë¡œ **ë®ì–´ì“°ê¸°** ë˜ì—ˆê³ 
* **`seatbelt` ì´í›„**ì—ëŠ” `hpass_check`ê°€,
* **`gear_shift` ì´ì „**ì—ëŠ” `mirror_check`ê°€ **ì‚½ì…**ë˜ì—ˆìŠµë‹ˆë‹¤.

ì „ì²´ ë³‘í•© ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”. ì´í›„ ì´ ë³‘í•© êµ¬ì¡°ë¥¼ LangGraph FSMì— ì§ì ‘ ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì›í•˜ì‹œë©´ ì´ ë³‘í•© ì½”ë“œë„ `.py` íŒŒì¼ë¡œ ë¬¶ì–´ zip ì œê³µí•´ë“œë¦´ê²Œìš”.

---

>>> ì „ì²´ í”„ë¡œì íŠ¸ í´ë”ì™€ íŒŒì¼êµ¬ì¡°ë¥¼ ë³´ì—¬ì¤˜.

ì•„ë˜ëŠ” ì§€ê¸ˆê¹Œì§€ êµ¬í˜„í•œ ë‚´ìš©(ì‹œë‚˜ë¦¬ì˜¤ ìƒì†, êµ­ê°€ë³„Â·ìƒí™©ë³„ ë³‘í•©, ë‹¤êµ­ì–´ ë²ˆì—­, LangGraph FSM, FastAPI ì„œë²„ í¬í•¨)ì„ ëª¨ë‘ í†µí•©í•œ **ì „ì²´ í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡°**ì…ë‹ˆë‹¤.

---

## ğŸ“ ì „ì²´ í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡°: `driving-agent-ai/`

```
driving-agent-ai/
â”‚
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Modelfile                         # Ollamaìš© LLM ì •ì˜
â”‚
â”œâ”€â”€ app/                              # LangGraph + FastAPI ì„œë²„
â”‚   â”œâ”€â”€ main.py                       # FastAPI ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ langgraph_runner.py          # ë³‘í•©ëœ ì‹œë‚˜ë¦¬ì˜¤ + FSM ì‹¤í–‰
â”‚   â”œâ”€â”€ scenario_loader.py           # ì‹œë‚˜ë¦¬ì˜¤ ë³‘í•© ë¡œì§ (ìƒì†/ë®ì–´ì“°ê¸° í¬í•¨)
â”‚   â””â”€â”€ translator.py                # prompt_key -> ì–¸ì–´ ë²ˆì—­ ì²˜ë¦¬
â”‚
â”œâ”€â”€ scenarios/                        # YAML ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜
â”‚   â”œâ”€â”€ global.yaml                   # ê³µí†µ ì‹œë‚˜ë¦¬ì˜¤
â”‚   â”œâ”€â”€ korea.yaml                    # í•œêµ­ íŠ¹í™” ì‹œë‚˜ë¦¬ì˜¤
â”‚   â”œâ”€â”€ beginner.yaml                 # ì´ˆë³´ ìš´ì „ììš© ì‹œë‚˜ë¦¬ì˜¤
â”‚   â””â”€â”€ ev.yaml                       # ì „ê¸°ì°¨ ìš´ì „ììš© ì‹œë‚˜ë¦¬ì˜¤
â”‚
â”œâ”€â”€ translations/                    # ì–¸ì–´ë³„ í…ìŠ¤íŠ¸ ë²ˆì—­
â”‚   â”œâ”€â”€ en.json
â”‚   â”œâ”€â”€ ko.json
â”‚   â””â”€â”€ ja.json
â”‚
â”œâ”€â”€ voice/                            # ìŒì„± ì…ì¶œë ¥ ì—°ë™
â”‚   â”œâ”€â”€ stt_client.py                 # STT API ì—°ë™ (ì˜ˆ: Whisper, Google STT)
â”‚   â”œâ”€â”€ tts_client.py                 # TTS API ì—°ë™ (ì˜ˆ: Google, Naver, ElevenLabs)
â”‚   â””â”€â”€ config.py                     # API í‚¤, ì„¤ì • íŒŒì¼
â”‚
â”œâ”€â”€ mobile/                           # í´ë¼ì´ì–¸íŠ¸ ì—°ë™
â”‚   â”œâ”€â”€ android/                      # Android ì•± ì—°ë™ ì½”ë“œ (Jetpack Compose)
â”‚   â””â”€â”€ ios/                          # iOS ì•± ì—°ë™ ì½”ë“œ (SwiftUI)
â”‚
â””â”€â”€ tests/                            # í…ŒìŠ¤íŠ¸ ì½”ë“œ
    â”œâ”€â”€ test_scenario_merge.py        # ë³‘í•© ë¡œì§ í…ŒìŠ¤íŠ¸
    â””â”€â”€ test_langgraph_integration.py # FSM í†µí•© í…ŒìŠ¤íŠ¸
```

---

## ğŸ“Œ ì£¼ìš” íŠ¹ì§• ìš”ì•½

| í•­ëª©                    | ì„¤ëª…                                                            |
| --------------------- | ------------------------------------------------------------- |
| `scenarios/`          | ì¡°ê±´ë³„ YAML ì‹œë‚˜ë¦¬ì˜¤, ìƒì† êµ¬ì¡° (`extends`, `overrides`, `insert_after`) |
| `translations/`       | ë²ˆì—­ í‚¤ â†’ ì–¸ì–´ í…ìŠ¤íŠ¸ ë¶„ë¦¬                                              |
| `scenario_loader.py`  | ì‹œë‚˜ë¦¬ì˜¤ ë³‘í•© ë¡œì§ (ë‹¤ì¤‘ ìƒì† + ì§€ì—­/ìƒí™© ë°˜ì˜)                                 |
| `langgraph_runner.py` | ë³‘í•©ëœ ì‹œë‚˜ë¦¬ì˜¤ â†’ LangGraph FSM ìƒì„±                                   |
| `main.py`             | FastAPI REST API (`/drive`)                                   |
| `voice/`              | STT/TTS ëª¨ë“ˆ (ìŒì„±ëª¨ë“œ)                                             |
| `mobile/`             | ì•±ê³¼ ì—°ë™í•  ìˆ˜ ìˆëŠ” REST ê¸°ë°˜ êµ¬ì¡° ì œê³µ                                     |

---

## âœ¨ í™•ì¥ ê³„íš ì‹œ ê³ ë ¤ì‚¬í•­

* ì‹œë‚˜ë¦¬ì˜¤ ìºì‹± (merged YAML â†’ JSON ì €ì¥)
* ì‹œë‚˜ë¦¬ì˜¤ ë³‘í•© ê²°ê³¼ ì‹œê°í™” ë„êµ¬
* ì‚¬ìš©ì ì„¸ì…˜ ê¸°ë°˜ ìƒíƒœ ì§€ì† ì €ì¥ (ex: Redis)
* ì‹œë‚˜ë¦¬ì˜¤ë³„ `test-case.yaml`ë¡œ ìë™ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í™”

---

í•„ìš”í•˜ì‹œë©´ ì´ êµ¬ì¡°ë¡œ ì‹¤ì œ íŒŒì¼ ìƒì„± ë° zip ì••ì¶•ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.
zipìœ¼ë¡œ ë¬¶ì–´ë“œë¦´ê¹Œìš”? ì•„ë‹ˆë©´ íŠ¹ì • íŒŒíŠ¸ë¶€í„° ì™„ì„±í• ê¹Œìš”?

---

>>> ë³‘í•©ëœ ì‹œë‚˜ë¦¬ì˜¤ â†’ LangGraph FSM ìë™ ì—°ê²°
>>> ì´ê±° ì§„í–‰í•´ì¤˜

í˜„ì¬ í™˜ê²½ì—ëŠ” `LangGraph` íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šì•„ FSM ìë™ ìƒì„± ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ì‚¬ìš©ì ë¡œì»¬ ë˜ëŠ” ì„œë²„ í™˜ê²½ì—ì„œëŠ” ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¼ ì‰½ê²Œ ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## âœ… 1. í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
pip install langgraph
```

---

## âœ… 2. ë³‘í•©ëœ ì‹œë‚˜ë¦¬ì˜¤ ê¸°ë°˜ LangGraph FSM ìƒì„± ì½”ë“œ

```python
from langgraph.graph import StateGraph, END
from typing import TypedDict

# LangGraphì—ì„œ ì‚¬ìš©í•  ìƒíƒœ êµ¬ì¡°
class AgentState(TypedDict):
    step_index: int
    slots: dict
    prompt: str

# ë³‘í•©ëœ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ LangGraph ë…¸ë“œ ìë™ ìƒì„± í•¨ìˆ˜
def build_langgraph_from_scenario(merged_scenario: dict):
    steps = merged_scenario["scenario"]["steps"]
    exceptions = merged_scenario["scenario"]["exceptions"]

    graph = StateGraph(AgentState)

    def make_node(step):
        def node_fn(state: AgentState) -> AgentState:
            user_input = state["slots"].get("user_input", "")
            # ì˜ˆì™¸ íƒì§€
            for rule in exceptions:
                for keyword in rule["trigger"]:
                    if keyword.lower() in user_input.lower():
                        return {**state, "prompt": f"[âš  ìœ„ê¸°ìƒí™©] {rule['response_key']}"}
            return {
                **state,
                "prompt": f"[{step['name']}] â†’ {step['prompt_key']}",
                "step_index": state.get("step_index", 0) + 1
            }
        return node_fn

    last_node = None
    for step in steps:
        node_name = step["name"]
        graph.add_node(node_name, make_node(step))
        if last_node is None:
            graph.set_entry_point(node_name)
        else:
            graph.add_edge(last_node, node_name)
        last_node = node_name

    graph.add_edge(last_node, END)
    return graph.compile()
```

---

## âœ… 3. ì˜ˆì œ ì‚¬ìš© ì½”ë“œ

```python
# ë³‘í•©ëœ ì‹œë‚˜ë¦¬ì˜¤ ë¡œë”© í›„ FSM ìƒì„±
fsm_app = build_langgraph_from_scenario(merged_result)

# ìƒíƒœ ì…ë ¥ í›„ ì‹¤í–‰
initial_state = AgentState(step_index=0, slots={"user_input": "ì‹œë™ ê±¸ì—ˆì–´ìš”"}, prompt="")
result = fsm_app.invoke(initial_state)
print(result["prompt"])
```

---

## ğŸ“Œ ê²°ê³¼

* ë³‘í•©ëœ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ LangGraph FSMì´ ìë™ ìƒì„±
* ë‹¨ê³„ë§ˆë‹¤ `step['name']`ì´ LangGraph ë…¸ë“œê°€ ë¨
* `prompt_key`ëŠ” ë²ˆì—­ ë˜ëŠ” í…ìŠ¤íŠ¸ ì¶”ì¶œì— ì‚¬ìš©
* ì‚¬ìš©ì ì…ë ¥ì— ì˜ˆì™¸ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ë©´ ìœ„ê¸° ëŒ€ì‘ ë©”ì‹œì§€ ì¶œë ¥

---

## ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

* `prompt_key` â†’ ì‹¤ì œ ì–¸ì–´ í…ìŠ¤íŠ¸ ë§¤í•‘ (ë‹¤êµ­ì–´ ì¶œë ¥)
* LangGraph FSMê³¼ FastAPI í†µí•©
* ì‚¬ìš©ì ì„¸ì…˜ë³„ë¡œ FSM ìƒíƒœ ì €ì¥ ë° ì´ì–´ì„œ ì§„í–‰

ì›í•˜ì‹œë©´ ì´ LangGraph ìë™ ìƒì„± ì½”ë“œë„ `.py` íŒŒì¼ë¡œ ì •ë¦¬í•´ì„œ í”„ë¡œì íŠ¸ì— í¬í•¨ì‹œì¼œ ë“œë¦´ê²Œìš”. ì§„í–‰í• ê¹Œìš”?

---

>>> ì‹œë‚˜ë¦¬ì˜¤ê°€ ë³µì¡í•´ì§€ë©´ yaml íŒŒì¼ë¡œ í¸ì§‘ì´ë‚˜ ì¶”ê°€ê°€ ì–´ë ¤ì›Œ ì§€ëŠ” ìƒí™©ì´ ì˜¤ëŠ”ë°, ì´ëŸ´ë• ì–´ë–¤ ìŠ¤ë§ˆíŠ¸í•œ ë°©ë²•ì´ ìˆì„ê¹Œ?

ë§ìŠµë‹ˆë‹¤. ì‹œë‚˜ë¦¬ì˜¤ê°€ ì»¤ì§€ê³  ë³µì¡í•´ì§ˆìˆ˜ë¡ **YAML íŒŒì¼ ì§ì ‘ í¸ì§‘ ë°©ì‹**ì€ ì•„ë˜ì™€ ê°™ì€ ë¬¸ì œë¥¼ ì´ˆë˜í•˜ê²Œ ë©ë‹ˆë‹¤:

---

## â—ï¸ë³µì¡í•œ YAML ìœ ì§€ì˜ í•œê³„

| ë¬¸ì œì        | ì„¤ëª…                                                |
| --------- | ------------------------------------------------- |
| âŒ ê°€ë…ì„± ì €í•˜  | ìˆ˜ë°± ì¤„ ì´ìƒì˜ YAMLì€ ì½ê¸°ë„, ì°¾ê¸°ë„ ì–´ë ¤ì›€                       |
| âŒ ì‹¤ìˆ˜ ìœ ë°œ   | `indent`, `name`, `insert_after` ë“±ì—ì„œ ì‘ì€ ì˜¤íƒ€ë„ ì˜¤ë¥˜ ë°œìƒ |
| âŒ í˜‘ì—… ì–´ë ¤ì›€  | ë””ìì´ë„ˆ/ê¸°íšìì™€ í˜‘ì—…ì´ í˜ë“¦ (ë¹„ê°œë°œì ì ‘ê·¼ ì œí•œ)                     |
| âŒ ì¤‘ë³µê³¼ ë¹„íš¨ìœ¨ | ë¹„ìŠ·í•œ ë‹¨ê³„ê°€ ì—¬ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ì— ì¤‘ë³µ ì •ì˜ë¨                           |

---

## âœ… í•´ê²° ì „ëµ: "ìŠ¤ë§ˆíŠ¸í•œ ì‹œë‚˜ë¦¬ì˜¤ ê´€ë¦¬ ë„êµ¬"

### ğŸ¯ ëª©í‘œ

> ì‹œë‚˜ë¦¬ì˜¤ë¥¼ **ë¹„ê°œë°œìë„ ì‹œê°ì ìœ¼ë¡œ í¸ì§‘** ê°€ëŠ¥í•˜ê³ ,
> ë‚´ë¶€ì ìœ¼ë¡œëŠ” YAML/JSONìœ¼ë¡œ ë³€í™˜ë˜ì–´ ë³‘í•© ê°€ëŠ¥í•œ êµ¬ì¡°ë¥¼ ë§Œë“¤ì!

---

## ğŸ’¡ 1. **ì›¹ ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ í¸ì§‘ GUI**

### ì˜ˆì‹œ: React + Drag\&Drop Builder

| ê¸°ëŠ¥                            | ì„¤ëª…                                       |
| ----------------------------- | ---------------------------------------- |
| ğŸ“‹ ë‹¨ê³„ ì¶”ê°€/ì‚­ì œ/ìˆœì„œ ë³€ê²½             | ì‹œê°ì ìœ¼ë¡œ í´ë¦­í•˜ì—¬ ì¡°ì‘ ê°€ëŠ¥                         |
| ğŸ§© insert\_before/after       | UIì—ì„œ ë“œë˜ê·¸ë¡œ ìœ„ì¹˜ ì§€ì •                          |
| ğŸ“ prompt\_key ì§ì ‘ ì…ë ¥ or ë²ˆì—­ ì„ íƒ |                                          |
| ğŸŒ êµ­ê°€/ìœ í˜•/ìƒí™© ì¡°ê±´ í•„í„°             | í•„í„° ì¡°í•©ìœ¼ë¡œ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±                          |
| ğŸ“ Export                     | JSON or YAMLë¡œ ì €ì¥ (LangGraph ë³‘í•© ì‹œìŠ¤í…œìœ¼ë¡œ ì—°ê²°) |

---

### ğŸ‘‰ ì¶”ì²œ ê¸°ìˆ  ìŠ¤íƒ

* í”„ë¡ íŠ¸ì—”ë“œ: `React`, `Tailwind`, `DND Kit`, `i18n`
* ë°±ì—”ë“œ API: FastAPI ê¸°ë°˜ íŒŒì¼ ì €ì¥/ë³€í™˜
* ì‹œë‚˜ë¦¬ì˜¤ ë³‘í•© ì—”ì§„: ê¸°ì¡´ Python merge logic ì¬ì‚¬ìš©

---

## ğŸ’¡ 2. **Google Sheet ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ ì„¤ê³„**

* ê° í–‰ì´ 1ê°œ Step, ê° ì—´ì´ `name`, `prompt_key`, `condition`, `insert_after`, `override_flag` ë“±
* ì‹œíŠ¸ì—ì„œ ê´€ë¦¬ â†’ Pythonìœ¼ë¡œ CSV ì½ê³  YAML ìë™ ìƒì„±

| name          | prompt\_key             | insert\_after | condition |
| ------------- | ----------------------- | ------------- | --------- |
| start\_engine | start\_engine           |               | global    |
| mirror\_check | beginner\_mirror\_check | seatbelt      | beginner  |
| hpass\_check  | korea\_hpass            | seatbelt      | korea     |

â†’ ì´ Sheetë¥¼ ì½ì–´ YAML íŒŒì¼ë¡œ ìë™ ë³€í™˜í•˜ëŠ” **Excel-to-YAML ë³€í™˜ê¸°** ì œì‘ ê°€ëŠ¥

---

## ğŸ’¡ 3. **ì‹œë‚˜ë¦¬ì˜¤ DSL(ë„ë©”ì¸ íŠ¹í™” ì–¸ì–´) ë„ì…**

```yaml
# easy_scenario.dsl.yaml
- when: country == "KR" and user == "beginner"
  do:
    - insert_after: seatbelt
      step:
        name: mirror_check
        prompt_key: beginner_mirror_check
    - override: gear_shift
      prompt_key: gear_shift_korea
```

â†’ ì´ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ YAML êµ¬ì¡°ë¡œ ë³€í™˜í•˜ëŠ” íŒŒì„œ ìƒì„±
â†’ ë³µì¡í•œ ì¡°ê±´ì‹ì„ ì§ê´€ì ìœ¼ë¡œ ì‘ì„± ê°€ëŠ¥

---

## âœ… ì •ë¦¬: ìƒí™©ì— ë§ëŠ” ì„ íƒì§€

| ë°©ì‹                  | ëŒ€ìƒ       | ì¥ì             | ë„ì… ë‚œì´ë„ |
| ------------------- | -------- | ------------- | ------ |
| Web GUI Builder     | ê¸°íšì/ë””ìì´ë„ˆ | ì‹œê°ì ì´ê³  ì‹¤ìˆ˜ ì—†ìŒ   | ì¤‘\~ìƒ   |
| Google Sheet â†’ YAML | ë¹„ê°œë°œ ê¸°íšì  | ì‰¬ìš´ ìœ ì§€ë³´ìˆ˜ + í˜‘ì—…  | í•˜      |
| DSL ìŠ¤í¬ë¦½íŠ¸            | ê³ ê¸‰ ì‚¬ìš©ì   | ì¡°ê±´ ë¶„ê¸° ê°€ë…ì„± ê·¹ëŒ€í™” | ì¤‘      |

---

## ğŸ“¦ ì œê°€ ë„ì™€ë“œë¦´ ìˆ˜ ìˆëŠ” ê²ƒ

* Google Sheet â†’ YAML ë³€í™˜ê¸° ì œì‘ (Python)
* Web ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ í¸ì§‘ê¸° UI ì„¤ê³„/ìƒ˜í”Œ êµ¬í˜„
* DSL ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜/ë³€í™˜ê¸° ì„¤ê³„

---

ì–´ë–¤ ë°©ì‹ì´ ê°€ì¥ ì í•©í•´ ë³´ì´ì‹œë‚˜ìš”?
ì˜ˆë¥¼ ë“¤ì–´ Web GUIë¶€í„° ì‹œì‘í• ê¹Œìš”, ì•„ë‹ˆë©´ Excel ê¸°ë°˜ìœ¼ë¡œ ê´€ë¦¬ë¶€í„° ê°œì„ í•´ë³¼ê¹Œìš”?

---

```javascript
// ScenarioGuiBuilder.tsx
import { useState, useCallback } from "react";
import ReactFlow, {
  Background,
  Controls,
  MiniMap,
  addEdge,
  useNodesState,
  useEdgesState,
  ReactFlowProvider,
  Handle,
  Position,
} from "reactflow";
import "reactflow/dist/style.css";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider } from "@/components/ui/tooltip";

const translationMap = {
  ko: {
    start_engine: "ì‹œë™ì„ ê±¸ì–´ì£¼ì„¸ìš”.",
    seatbelt: "ì•ˆì „ë²¨íŠ¸ë¥¼ ì°©ìš©í•˜ì„¸ìš”.",
    gear_shift: "ê¸°ì–´ë¥¼ Pì—ì„œ Dë¡œ ë³€ê²½í•˜ì„¸ìš”.",
    condition_step_1: "ì¡°ê±´ ë¶„ê¸° ì˜ˆì‹œì…ë‹ˆë‹¤.",
    error_step_2: "ì˜ˆì™¸ ì²˜ë¦¬ ì˜ˆì‹œì…ë‹ˆë‹¤.",
  },
  en: {
    start_engine: "Please start the engine.",
    seatbelt: "Fasten your seatbelt.",
    gear_shift: "Shift the gear from P to D.",
    condition_step_1: "This is a conditional step.",
    error_step_2: "This is an error handler step.",
  },
};

let id = 0;
const getId = () => `step-${id++}`;

function CustomNode({ data }) {
  const lang = "ko";
  const translation = translationMap[lang]?.[data.promptKey] || "";
  const allTranslations = Object.entries(translationMap)
    .map(([lang, dict]) => `${lang}: ${dict[data.promptKey] || "(ì—†ìŒ)"}`)
    .join("\n");

  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
          <div
            className={`border rounded p-2 shadow w-60 cursor-pointer ${data.type === "condition" ? "bg-yellow-100" : data.type === "error" ? "bg-red-100" : "bg-white"}`}
          >
            <Handle type="target" position={Position.Top} />
            <div className="text-sm font-bold mb-1">{data.label} ({data.type || "normal"})</div>
            <Input
              className="text-xs mb-1"
              value={data.promptKey || ""}
              onChange={(e) => data.onPromptChange(data.id, e.target.value)}
              placeholder="prompt_key"
            />
            <div className="text-xs italic text-gray-500 min-h-[1.25rem]">
              ğŸŒ {translation || "(ë²ˆì—­ ì—†ìŒ)"}
            </div>
            <Handle type="source" position={Position.Bottom} />
          </div>
        </TooltipTrigger>
        <TooltipContent side="right">
          <pre className="text-xs whitespace-pre-wrap">{allTranslations}</pre>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
}

const nodeTypes = {
  custom: CustomNode,
};

function FlowEditor() {
  const initialNodes = [
    {
      id: getId(),
      type: "custom",
      position: { x: 100, y: 100 },
      data: { label: "start_engine", promptKey: "start_engine", type: "normal", onPromptChange },
    },
  ];

  const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);
  const [edges, setEdges, onEdgesChange] = useEdgesState([]);

  const onConnect = useCallback(
    (params) => setEdges((eds) => addEdge(params, eds)),
    [setEdges]
  );

  const addNode = (type = "normal") => {
    const newId = getId();
    const newNode = {
      id: newId,
      type: "custom",
      position: {
        x: Math.random() * 400 + 100,
        y: Math.random() * 400 + 100,
      },
      data: {
        id: newId,
        label: `${type}_step_${id}`,
        promptKey: `${type}_step_${id}`,
        type,
        onPromptChange,
      },
    };
    setNodes((nds) => [...nds, newNode]);
  };

  const onPromptChange = (id, newPrompt) => {
    setNodes((nds) =>
      nds.map((n) =>
        n.id === id ? { ...n, data: { ...n.data, promptKey: newPrompt } } : n
      )
    );
  };

  const exportFSM = () => {
    const nodeMap = Object.fromEntries(nodes.map((n) => [n.id, n.data.label]));
    const code = `from langgraph.graph import StateGraph, END\n\nclass AgentState(dict):\n    pass\n\ndef make_node(prompt):\n    def node_fn(state):\n        return {**state, \"prompt\": prompt, \"step_index\": state.get(\"step_index\", 0) + 1}\n    return node_fn\n\ngraph = StateGraph(AgentState)\n`;

    const nodeDefs = nodes
      .map(
        (n) => `graph.add_node(\"${n.data.label}\", make_node(\"${n.data.promptKey || n.data.label}\"))`
      )
      .join("\n");

    const edgeDefs = edges
      .map(
        (e) =>
          `graph.add_edge(\"${nodeMap[e.source]}\", \"${nodeMap[e.target]}\")`
      )
      .join("\n");

    const entry = nodes.length > 0 ? `graph.set_entry_point(\"${nodes[0].data.label}\")` : "";
    const compile = "\nfsm_app = graph.compile()";
    alert(`${code}\n${nodeDefs}\n${edgeDefs}\n${entry}${compile}`);
  };

  return (
    <div className="w-full h-[600px]">
      <ReactFlow
        nodes={nodes}
        edges={edges}
        onNodesChange={onNodesChange}
        onEdgesChange={onEdgesChange}
        onConnect={onConnect}
        fitView
        nodeTypes={nodeTypes}
      >
        <Background />
        <Controls />
        <MiniMap />
      </ReactFlow>
      <div className="flex gap-2 mt-4 p-4">
        <Button onClick={() => addNode("normal")}>ë…¸ë“œ ì¶”ê°€</Button>
        <Button onClick={() => addNode("condition")}>ì¡°ê±´ ë¶„ê¸° ë…¸ë“œ ì¶”ê°€</Button>
        <Button onClick={() => addNode("error")}>ì˜ˆì™¸ ë…¸ë“œ ì¶”ê°€</Button>
        <Button onClick={exportFSM}>LangGraph FSM ì½”ë“œ ìƒì„±</Button>
      </div>
    </div>
  );
}

export default function ScenarioBuilder() {
  return (
    <div className="p-4 max-w-full">
      <h1 className="text-xl font-bold mb-4">ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ê·¸ë˜í”„ ë¹Œë”</h1>
      <ReactFlowProvider>
        <FlowEditor />
      </ReactFlowProvider>
    </div>
  );
}

```

---

>>> ì•„ë˜ ê¸°ëŠ¥ì„ ëª¨ë‘ í¬í•¨í•´ì„œ êµ¬í˜„í•´ì¤˜
>>> 
>>> ğŸ“¥ YAML DSL â†’ GUI ìë™ ë¡œë”©
>>> ğŸ“¤ GUI â†’ YAML DSL ìë™ ë‚´ë³´ë‚´ê¸°
>>> ğŸŒ ì–¸ì–´ ì„ íƒ ë“œë¡­ë‹¤ìš´

``` javascript
// ScenarioGuiBuilder.tsx
import { useState, useCallback, useEffect } from "react";
import ReactFlow, {
  Background,
  Controls,
  MiniMap,
  addEdge,
  useNodesState,
  useEdgesState,
  ReactFlowProvider,
  Handle,
  Position,
} from "reactflow";
import "reactflow/dist/style.css";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider } from "@/components/ui/tooltip";
import { loadYamlScenario, exportToYaml } from "@/lib/yamlHelper";
import { loadTranslations } from "@/lib/i18nLoader";

const nodeTypes = {
  custom: CustomNode,
};

let id = 0;
const getId = () => `step-${id++}`;

function CustomNode({ data }) {
  const { translations, selectedLang } = data;
  const translation = translations?.[selectedLang]?.[data.promptKey] || "";
  const allTranslations = Object.entries(translations || {})
    .map(([lang, dict]) => `${lang}: ${dict[data.promptKey] || "(ì—†ìŒ)"}`)
    .join("\n");

  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
          <div
            className={`border rounded p-2 shadow w-60 cursor-pointer ${data.type === "condition" ? "bg-yellow-100" : data.type === "error" ? "bg-red-100" : "bg-white"}`}
          >
            <Handle type="target" position={Position.Top} />
            <div className="text-sm font-bold mb-1">{data.label} ({data.type || "normal"})</div>
            <Input
              className="text-xs mb-1"
              value={data.promptKey || ""}
              onChange={(e) => data.onPromptChange(data.id, e.target.value)}
              placeholder="prompt_key"
            />
            <div className="text-xs italic text-gray-500 min-h-[1.25rem]">
              ğŸŒ {translation || "(ë²ˆì—­ ì—†ìŒ)"}
            </div>
            <Handle type="source" position={Position.Bottom} />
          </div>
        </TooltipTrigger>
        <TooltipContent side="right">
          <pre className="text-xs whitespace-pre-wrap">{allTranslations}</pre>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
}

function FlowEditor() {
  const [nodes, setNodes, onNodesChange] = useNodesState([]);
  const [edges, setEdges, onEdgesChange] = useEdgesState([]);
  const [translations, setTranslations] = useState({});
  const [selectedLang, setSelectedLang] = useState("ko");

  const onConnect = useCallback(
    (params) => setEdges((eds) => addEdge(params, eds)),
    [setEdges]
  );

  const onPromptChange = (id, newPrompt) => {
    setNodes((nds) =>
      nds.map((n) =>
        n.id === id ? { ...n, data: { ...n.data, promptKey: newPrompt } } : n
      )
    );
  };

  const addNode = (type = "normal") => {
    const newId = getId();
    const newNode = {
      id: newId,
      type: "custom",
      position: {
        x: Math.random() * 400 + 100,
        y: Math.random() * 400 + 100,
      },
      data: {
        id: newId,
        label: `${type}_step_${id}`,
        promptKey: `${type}_step_${id}`,
        type,
        translations,
        selectedLang,
        onPromptChange,
      },
    };
    setNodes((nds) => [...nds, newNode]);
  };

  const exportToYamlDSL = () => {
    const yaml = exportToYaml(nodes, edges);
    console.log(yaml);
    alert("YAML DSL ì½˜ì†”ì— ì¶œë ¥ë¨");
  };

  const loadYaml = async () => {
    const { nodes: loadedNodes, edges: loadedEdges } = await loadYamlScenario("/example/scenario.yaml", translations, selectedLang, onPromptChange);
    setNodes(loadedNodes);
    setEdges(loadedEdges);
  };

  useEffect(() => {
    loadTranslations(selectedLang).then(setTranslations);
  }, [selectedLang]);

  return (
    <div className="w-full h-[600px]">
      <div className="flex gap-2 mb-2">
        <select value={selectedLang} onChange={(e) => setSelectedLang(e.target.value)} className="border p-1 rounded">
          <option value="ko">í•œêµ­ì–´</option>
          <option value="en">English</option>
        </select>
        <Button onClick={() => addNode("normal")}>ë…¸ë“œ ì¶”ê°€</Button>
        <Button onClick={() => addNode("condition")}>ì¡°ê±´ ë¶„ê¸° ë…¸ë“œ ì¶”ê°€</Button>
        <Button onClick={() => addNode("error")}>ì˜ˆì™¸ ë…¸ë“œ ì¶”ê°€</Button>
        <Button onClick={loadYaml}>ğŸ“¥ YAML ë¶ˆëŸ¬ì˜¤ê¸°</Button>
        <Button onClick={exportToYamlDSL}>ğŸ“¤ YAML ë‚´ë³´ë‚´ê¸°</Button>
      </div>

      <ReactFlow
        nodes={nodes}
        edges={edges}
        onNodesChange={onNodesChange}
        onEdgesChange={onEdgesChange}
        onConnect={onConnect}
        fitView
        nodeTypes={nodeTypes}
      >
        <Background />
        <Controls />
        <MiniMap />
      </ReactFlow>
    </div>
  );
}

export default function ScenarioBuilder() {
  return (
    <div className="p-4 max-w-full">
      <h1 className="text-xl font-bold mb-4">ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ê·¸ë˜í”„ ë¹Œë”</h1>
      <ReactFlowProvider>
        <FlowEditor />
      </ReactFlowProvider>
    </div>
  );
}
```

âœ… ì´ì œ ë‹¤ìŒ ê¸°ëŠ¥ì´ í¬í•¨ëœ **ìµœì¢… GUI ë¹Œë” ì½”ë“œ**ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤:

---

### ğŸ§© í¬í•¨ëœ ì£¼ìš” ê¸°ëŠ¥:

| ê¸°ëŠ¥                        | ì„¤ëª…                                            |
| ------------------------- | --------------------------------------------- |
| ğŸ“¥ YAML DSL â†’ GUI ìë™ ë¡œë”©   | `loadYamlScenario()` í˜¸ì¶œ ì‹œ YAML ì‹œë‚˜ë¦¬ì˜¤ë¥¼ GUIë¡œ ì‹œê°í™” |
| ğŸ“¤ GUI â†’ YAML DSL ìë™ ë‚´ë³´ë‚´ê¸° | ë²„íŠ¼ í´ë¦­ ì‹œ í˜„ì¬ GUI ìƒíƒœë¥¼ YAMLë¡œ ì¶”ì¶œ                   |
| ğŸŒ ì–¸ì–´ ì„ íƒ ë“œë¡­ë‹¤ìš´             | ì–¸ì–´ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ì–¸ì–´ì˜ ë²ˆì—­ì´ íˆ´íŒ ë° ë…¸ë“œì— ë°˜ì˜ë¨              |

---

### ğŸ“ ì¶”ê°€ ì—°ë™ êµ¬ì„± ì œì•ˆ:

* `/public/example/scenario.yaml`: ì˜ˆì œ ì‹œë‚˜ë¦¬ì˜¤ íŒŒì¼
* `/translations/ko.json`, `/translations/en.json`: ì–¸ì–´ë³„ JSON ë²ˆì—­ íŒŒì¼
* `i18nLoader.ts`, `yamlHelper.ts`: í—¬í¼ ìœ í‹¸ë¡œ ë²ˆì—­ ë° YAML ë³€í™˜ ì²˜ë¦¬

í•„ìš”í•˜ì‹œë©´ ìœ„ íŒŒì¼ë“¤ë„ ë°”ë¡œ êµ¬ì„±í•´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³„ì†í•´ì„œ ì–´ë–¤ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê±°ë‚˜ ë°°í¬í• ì§€ ì•Œë ¤ì£¼ì„¸ìš”!

---

>>> ìœ„ ì½”ë“œë¥¼ ë¡œì»¬ì—ì„œ ëŒë ¤ë³´ê³  ì‹¶ì–´. ì–´ë–»ê²Œ í•´ì•¼í•˜ëŠ”ì§€ ëª¨ë“  ë‹¨ê³„ë¥¼ ì„¤ëª…í•´ì¤˜

ì¢‹ì•„ìš”! ì§€ê¸ˆ ë³´ê³  ê³„ì‹  **React ê¸°ë°˜ GUI ì‹œë‚˜ë¦¬ì˜¤ ë¹Œë” ì½”ë“œ**ë¥¼ ë¡œì»¬ì—ì„œ ì‹¤í–‰í•˜ë ¤ë©´ ì•„ë˜ì™€ ê°™ì´ ë‹¨ê³„ë³„ë¡œ ì§„í–‰í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

---

## âœ… 1. í•„ìˆ˜ ì¤€ë¹„ ì‚¬í•­

* Node.js (18.x ì´ìƒ ê¶Œì¥)
* íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €: `npm` ë˜ëŠ” `yarn`
* ì½”ë“œ í¸ì§‘ê¸° (VSCode ë“±)

---

## ğŸ“ 2. í”„ë¡œì íŠ¸ êµ¬ì¡° ë§Œë“¤ê¸°

```bash
mkdir scenario-gui-builder
cd scenario-gui-builder
npm create vite@latest
# âœ” í”„ë¡œì íŠ¸ ì´ë¦„: scenario-gui-builder
# âœ” í”„ë ˆì„ì›Œí¬: React
# âœ” Variant: TypeScript
cd scenario-gui-builder
```

---

## ğŸ“¦ 3. íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
npm install
npm install reactflow
npm install clsx
npm install tailwindcss postcss autoprefixer
npx tailwindcss init -p
```

### `tailwind.config.js` ìˆ˜ì •:

```ts
content: ["./index.html", "./src/**/*.{js,ts,jsx,tsx}"],
```

### `src/index.css` ìˆ˜ì •:

```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

---

## ğŸ§  4. ì»´í¬ë„ŒíŠ¸ ë° ìœ í‹¸ íŒŒì¼ êµ¬ì„±

### `src/components/ScenarioGuiBuilder.tsx` â†’ ë³µì‚¬ ë¶™ì—¬ë„£ê¸°

(ì§€ê¸ˆ ë³´ê³  ê³„ì‹  ì „ì²´ ì½”ë“œ)

### `src/components/ui/` í´ë” ìƒì„± í›„ ë‹¤ìŒ êµ¬ì„±:

* `button.tsx`: Tailwind Button ì»´í¬ë„ŒíŠ¸
* `input.tsx`: Tailwind Input ì»´í¬ë„ŒíŠ¸
* `tooltip.tsx`: Tooltipìš© ë˜í¼ ì»´í¬ë„ŒíŠ¸

(í•„ìš”í•˜ë©´ ìƒ˜í”Œ ì½”ë“œ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)

---

## ğŸŒ 5. ë²ˆì—­ ë° YAML íŒŒì¼ êµ¬ì„±

### í´ë” êµ¬ì¡°:

```
/public/
  â”œâ”€â”€ translations/
  â”‚     â”œâ”€â”€ ko.json
  â”‚     â””â”€â”€ en.json
  â””â”€â”€ example/
        â””â”€â”€ scenario.yaml
```

### `ko.json` ì˜ˆì‹œ:

```json
{
  "start_engine": "ì‹œë™ì„ ê±¸ì–´ì£¼ì„¸ìš”.",
  "seatbelt": "ì•ˆì „ë²¨íŠ¸ë¥¼ ì°©ìš©í•˜ì„¸ìš”."
}
```

### `scenario.yaml` ì˜ˆì‹œ:

```yaml
nodes:
  - id: start_engine
    type: normal
    prompt_key: start_engine
  - id: seatbelt
    type: normal
    prompt_key: seatbelt
edges:
  - from: start_engine
    to: seatbelt
```

---

## âš™ï¸ 6. ìœ í‹¸ íŒŒì¼ ì¶”ê°€

### `src/lib/i18nLoader.ts`

```ts
export async function loadTranslations(lang: string): Promise<Record<string, string>> {
  const res = await fetch(`/translations/${lang}.json`);
  return await res.json();
}
```

### `src/lib/yamlHelper.ts`

```ts
import YAML from 'yaml';

export function exportToYaml(nodes: any[], edges: any[]) {
  const yaml = YAML.stringify({ nodes, edges });
  return yaml;
}

export async function loadYamlScenario(path: string, translations: any, lang: string, onPromptChange: Function) {
  const res = await fetch(path);
  const text = await res.text();
  const parsed = YAML.parse(text);
  const nodes = (parsed.nodes || []).map((n, idx) => ({
    id: n.id || `node-${idx}`,
    type: "custom",
    position: { x: 100 + idx * 50, y: 100 + idx * 50 },
    data: {
      id: n.id,
      label: n.prompt_key,
      promptKey: n.prompt_key,
      type: n.type || "normal",
      translations,
      selectedLang: lang,
      onPromptChange
    }
  }));
  const edges = parsed.edges || [];
  return { nodes, edges };
}
```

---

## ğŸš€ 7. ì‹¤í–‰

```bash
npm run dev
```

ë¸Œë¼ìš°ì €ì—ì„œ: [http://localhost:5173](http://localhost:5173)

---

## ğŸ“¦ ë²ˆë“¤ë¡œ ë§Œë“¤ê¸°

```bash
npm run build
```

---

## ğŸ“ ì›í•˜ì‹œë©´â€¦

* ì „ì²´ êµ¬ì¡° `.zip` íŒŒì¼ë¡œ íŒ¨í‚¤ì§•
* GitHub ë°°í¬ìš© í…œí”Œë¦¿ êµ¬ì„±
* Vercel / Netlifyë¡œ ë°°í¬

ë„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆì–´ìš”. í•„ìš”í•˜ì‹ ê°€ìš”?

---

>>> ìœˆë„ìš° í™˜ê²½ì—ì„œ ëŒë ¤ë³´ê³  ì‹¶ì–´

ì¢‹ì•„ìš”! Windows í™˜ê²½ì—ì„œ ì§€ê¸ˆ ë³´ê³  ê³„ì‹  **React ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤ GUI ë¹Œë”**ë¥¼ ë¡œì»¬ì—ì„œ ì‹¤í–‰í•˜ë ¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ê·¸ëŒ€ë¡œ ë”°ë¼ í•˜ì‹œë©´ ë©ë‹ˆë‹¤. (Windows 10 ë˜ëŠ” 11 ê¸°ì¤€)

---

## âœ… 1. í•„ìˆ˜ ì„¤ì¹˜

### ğŸ“¦ Node.js ì„¤ì¹˜

* ê³µì‹ ì›¹ì‚¬ì´íŠ¸: [https://nodejs.org](https://nodejs.org)
* LTS ë²„ì „ (ê¶Œì¥): `v18.x` ì´ìƒ

ğŸ‘‰ ì„¤ì¹˜ í›„, ì•„ë˜ ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜ í™•ì¸:

```bash
node -v
npm -v
```

---

## ğŸ§± 2. í”„ë¡œì íŠ¸ ìƒì„±

### í„°ë¯¸ë„(Powershell, CMD, í˜¹ì€ Git Bash) ì—´ê¸°:

```bash
mkdir scenario-gui-builder
cd scenario-gui-builder
npm create vite@latest
```

* í”„ë¡œì íŠ¸ ì´ë¦„: `scenario-gui-builder`
* í”„ë ˆì„ì›Œí¬: `React`
* Variant: `TypeScript`

```bash
cd scenario-gui-builder
npm install
```

---

## ğŸ§© 3. í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
npm install reactflow
npm install clsx
npm install yaml
npm install tailwindcss postcss autoprefixer
npx tailwindcss init -p
```

---

## ğŸ¨ 4. Tailwind ì„¤ì •

### ğŸ“„ `tailwind.config.js` ìˆ˜ì •

```js
module.exports = {
  content: ["./index.html", "./src/**/*.{js,ts,jsx,tsx}"],
  theme: {
    extend: {},
  },
  plugins: [],
}
```

### ğŸ“„ `src/index.css` ìˆ˜ì •

```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

---

## ğŸ“ 5. ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±

```
scenario-gui-builder/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ translations/
â”‚   â”‚   â”œâ”€â”€ ko.json
â”‚   â”‚   â””â”€â”€ en.json
â”‚   â””â”€â”€ example/
â”‚       â””â”€â”€ scenario.yaml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ ScenarioGuiBuilder.tsx â† â¬…ï¸ ì½”ë“œ ë¶™ì—¬ë„£ê¸°
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ i18nLoader.ts
â”‚   â”‚   â””â”€â”€ yamlHelper.ts
â”‚   â””â”€â”€ main.tsx
```

---

## ğŸŒ 6. ì˜ˆì œ ë°ì´í„° ì¤€ë¹„

### âœ… `public/translations/ko.json`

```json
{
  "start_engine": "ì‹œë™ì„ ê±¸ì–´ì£¼ì„¸ìš”.",
  "seatbelt": "ì•ˆì „ë²¨íŠ¸ë¥¼ ì°©ìš©í•˜ì„¸ìš”.",
  "gear_shift": "ê¸°ì–´ë¥¼ ë³€ê²½í•˜ì„¸ìš”."
}
```

### âœ… `public/example/scenario.yaml`

```yaml
nodes:
  - id: start_engine
    type: normal
    prompt_key: start_engine
  - id: seatbelt
    type: normal
    prompt_key: seatbelt
edges:
  - from: start_engine
    to: seatbelt
```

---

## ğŸ§  7. ìœ í‹¸ íŒŒì¼ ì½”ë“œ

### âœ… `src/lib/i18nLoader.ts`

```ts
export async function loadTranslations(lang: string): Promise<Record<string, string>> {
  const res = await fetch(`/translations/${lang}.json`);
  return await res.json();
}
```

### âœ… `src/lib/yamlHelper.ts`

```ts
import YAML from "yaml";

export function exportToYaml(nodes: any[], edges: any[]) {
  return YAML.stringify({
    nodes: nodes.map(n => ({
      id: n.data.id,
      type: n.data.type,
      prompt_key: n.data.promptKey
    })),
    edges
  });
}

export async function loadYamlScenario(path: string, translations: any, lang: string, onPromptChange: Function) {
  const res = await fetch(path);
  const text = await res.text();
  const parsed = YAML.parse(text);
  const nodes = (parsed.nodes || []).map((n, idx) => ({
    id: n.id || `node-${idx}`,
    type: "custom",
    position: { x: 100 + idx * 80, y: 100 + idx * 50 },
    data: {
      id: n.id,
      label: n.prompt_key,
      promptKey: n.prompt_key,
      type: n.type || "normal",
      translations,
      selectedLang: lang,
      onPromptChange,
    },
  }));
  const edges = parsed.edges || [];
  return { nodes, edges };
}
```

---

## ğŸš€ 8. ì‹¤í–‰

```bash
npm run dev
```

* ì‹¤í–‰ í›„ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†: [http://localhost:5173](http://localhost:5173)

---

## ğŸ“¦ 9. ë¹Œë“œ (ì„ íƒ)

```bash
npm run build
```

ë¹Œë“œëœ ê²°ê³¼ë¬¼ì€ `/dist` í´ë”ì— ìƒì„±ë©ë‹ˆë‹¤.

---

## â“ ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?

* `.zip` í˜•íƒœë¡œ ì „ì²´ í”„ë¡œì íŠ¸ ì œê³µ ê°€ëŠ¥
* GitHubì— ì—…ë¡œë“œ ê°€ëŠ¥í•œ ê¸°ë³¸ í…œí”Œë¦¿ ì œê³µ ê°€ëŠ¥
* Vercel ë˜ëŠ” Netlifyë¡œ ë°°í¬ë„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆì–´ìš”

í•„ìš”í•˜ì‹  í•­ëª© ì•Œë ¤ì£¼ì„¸ìš”!
